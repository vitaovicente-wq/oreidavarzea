<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRFutebol - Painel</title>
    <script src="engine.js"></script>

    <style>
        /* --- ESTILOS (Dark Theme) --- */
        :root { --bg: #0d1115; --card: #161b22; --green: #2ecc71; --text: #ecf0f1; --border: #333; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; display: flex; height: 100vh; overflow: hidden; }

        /* MENU LATERAL */
        .sidebar { width: 250px; background: var(--card); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; }
        .logo { font-size: 1.5rem; font-weight: 900; margin-bottom: 30px; letter-spacing: 1px; }
        .logo span { color: var(--green); }
        .menu-item { padding: 12px; margin-bottom: 5px; cursor: pointer; border-radius: 8px; color: #888; transition: 0.2s; text-decoration: none; display: block; }
        .menu-item:hover, .menu-item.active { background: rgba(46, 204, 113, 0.1); color: var(--green); }
        .btn-sair { margin-top: auto; color: #ff4757; }

        /* √ÅREA PRINCIPAL */
        .content { flex: 1; padding: 30px; overflow-y: auto; display: grid; grid-template-columns: 2fr 1fr; gap: 20px; grid-template-rows: auto 1fr; }
        
        /* CARDS */
        .header-card { grid-column: 1 / -1; background: var(--card); padding: 20px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border); }
        .team-info h2 { margin: 0; font-size: 1.8rem; }
        .team-info p { margin: 5px 0 0; color: #666; font-size: 0.9rem; }
        .status-pill { background: #000; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; border: 1px solid #333; display: flex; gap: 15px; }

        .game-card { background: var(--card); border-radius: 12px; border: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; }
        .card-title { font-size: 0.9rem; color: #666; text-transform: uppercase; font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }

        /* PR√ìXIMO JOGO */
        .match-display { display: flex; justify-content: space-around; align-items: center; padding: 20px 0; }
        .team-vs { text-align: center; width: 100px; }
        .team-vs img { width: 50px; height: 50px; object-fit: contain; margin-bottom: 5px; }
        .vs-sign { font-size: 1.5rem; font-weight: 900; color: #333; }
        .btn-play { background: var(--green); color: #fff; border: none; width: 100%; padding: 15px; border-radius: 8px; font-weight: 900; font-size: 1rem; cursor: pointer; text-transform: uppercase; margin-top: auto; }
        .btn-play:hover { opacity: 0.9; }

        /* TABELA */
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { text-align: left; color: #666; padding: 5px; font-size: 0.8rem; }
        td { padding: 8px 5px; border-bottom: 1px solid #222; }
        .pos-num { width: 20px; color: #888; }
        .my-team-row { color: var(--green); font-weight: bold; }

        /* ELENCO */
        .squad-list { display: flex; flex-direction: column; gap: 5px; max-height: 300px; overflow-y: auto; }
        .player-row { display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 4px; }
        .pl-pos { font-weight: bold; width: 40px; color: #666; font-size: 0.8rem; }
        
        @media (max-width: 900px) { .content { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="logo">BR<span>FUTEBOL</span></div>
        <a class="menu-item active">üè† Vis√£o Geral</a>
        <a class="menu-item" href="calendario.html">üìÖ Calend√°rio</a>
        <a class="menu-item">üëï Elenco</a>
        <a class="menu-item btn-sair" onclick="sair()">‚úñ Sair do Jogo</a>
    </nav>

    <main class="content">
        <div class="header-card">
            <div class="team-info">
                <h2 id="team-name">Carregando...</h2>
                <p id="coach-name">T√©cnico: ---</p>
            </div>
            <div class="status-pill">
                <span id="money-display">R$ ---</span>
                <span id="round-display">Rodada 1</span>
            </div>
        </div>

        <div class="game-card">
            <div class="card-title">Pr√≥ximo Desafio</div>
            <div class="match-display" id="next-match-area">
                <p>Carregando confronto...</p>
            </div>
            <button class="btn-play" onclick="irParaJogo()">Ir para o Est√°dio üèüÔ∏è</button>
        </div>

        <div class="game-card" style="grid-row: span 2">
            <div class="card-title">Classifica√ß√£o</div>
            <div style="overflow-y: auto; max-height: 400px;">
                <table id="table-body">
                    </table>
            </div>
        </div>

        <div class="game-card">
            <div class="card-title">Elenco Principal</div>
            <div class="squad-list" id="squad-body">
                </div>
        </div>
    </main>

    <script>
        // --- L√ìGICA DO DASHBOARD ---

        // 1. Carregar dados ao iniciar
        window.onload = function() {
            console.log("Iniciando Dashboard...");
            
            // Tenta carregar o save
            const game = Engine.carregarJogo();

            // SE N√ÉO TIVER SAVE, VOLTA PRO IN√çCIO
            if (!game || !game.info) {
                alert("Nenhum jogo encontrado. Voltando para o menu.");
                window.location.href = 'index.html';
                return;
            }

            // 2. Preencher Cabe√ßalho
            document.getElementById('team-name').innerText = game.info.time;
            document.getElementById('coach-name').innerText = "T√©cnico: " + game.info.tecnico;
            document.getElementById('money-display').innerText = "R$ " + (game.recursos.dinheiro / 1000000).toFixed(1) + " Mi";
            document.getElementById('round-display').innerText = "Rodada " + game.rodadaAtual;

            // 3. Preencher Pr√≥ximo Jogo
            renderizarProximoJogo(game);

            // 4. Preencher Tabela (COM PROTE√á√ÉO CONTRA ERRO)
            renderizarTabela(game);

            // 5. Preencher Elenco (COM PROTE√á√ÉO)
            renderizarElenco(game);
        };

        function renderizarProximoJogo(game) {
            const area = document.getElementById('next-match-area');
            const rodadaIndex = game.rodadaAtual - 1;

            // Verifica se o calend√°rio existe e se a rodada √© v√°lida
            if (!game.calendario || !game.calendario[rodadaIndex]) {
                area.innerHTML = "<p>Fim da Temporada!</p>";
                document.querySelector('.btn-play').disabled = true;
                return;
            }

            // Procura o jogo do meu time na rodada atual
            const jogosDaRodada = game.calendario[rodadaIndex].jogos || [];
            const meuJogo = jogosDaRodada.find(j => j.mandante === game.info.time || j.visitante === game.info.time);

            if (meuJogo) {
                const imgPadrao = "https://cdn-icons-png.flaticon.com/512/53/53283.png";
                area.innerHTML = `
                    <div class="team-vs">
                        <img src="${imgPadrao}">
                        <div>${meuJogo.mandante.substring(0,10)}</div>
                    </div>
                    <div class="vs-sign">VS</div>
                    <div class="team-vs">
                        <img src="${imgPadrao}">
                        <div>${meuJogo.visitante.substring(0,10)}</div>
                    </div>
                `;
            } else {
                area.innerHTML = "<p>Folga nesta rodada.</p>";
            }
        }

        function renderizarTabela(game) {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = `<tr><th>#</th><th>Time</th><th>P</th></tr>`;

            // Prote√ß√£o: Se a tabela n√£o existir, cria uma lista vazia para n√£o dar erro
            const lista = game.classificacao || [];

            lista.slice(0, 10).forEach((time, index) => {
                const isMe = time.nome === game.info.time ? 'class="my-team-row"' : '';
                const row = `
                    <tr ${isMe}>
                        <td class="pos-num">${index + 1}</td>
                        <td>${time.nome}</td>
                        <td><strong>${time.pts}</strong></td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function renderizarElenco(game) {
            const container = document.getElementById('squad-body');
            container.innerHTML = '';

            // Usa a fun√ß√£o segura da Engine ou busca na m√£o
            let meuTimeObj = null;
            if (Engine.getMeuTime) {
                meuTimeObj = Engine.getMeuTime();
            } else {
                // Fallback caso a fun√ß√£o n√£o exista
                meuTimeObj = game.times.find(t => t.nome === game.info.time);
            }

            // Prote√ß√£o: Se n√£o achar o time ou elenco, usa array vazio
            const elenco = (meuTimeObj && meuTimeObj.elenco) ? meuTimeObj.elenco : [];

            if (elenco.length === 0) {
                container.innerHTML = '<p style="color:#666; text-align:center">Elenco vazio ou n√£o carregado.</p>';
                return;
            }

            elenco.forEach(jog => {
                const div = document.createElement('div');
                div.className = 'player-row';
                div.innerHTML = `
                    <span class="pl-pos">${jog.pos}</span>
                    <span>${jog.nome}</span>
                    <span style="color:var(--green)">${jog.forca}</span>
                `;
                container.appendChild(div);
            });
        }

        function irParaJogo() {
            alert("Sistema de partida ser√° o pr√≥ximo passo!");
            // window.location.href = 'partida.html';
        }

        function sair() {
            if(confirm("Deseja sair? Seu progresso est√° salvo.")) {
                window.location.href = 'index.html';
            }
        }
    </script>
</body>
</html>
