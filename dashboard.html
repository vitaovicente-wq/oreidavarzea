<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRFutebol - Painel de Controle</title>
    
    <script src="database_jogadores.js"></script>
    <script src="engine.js"></script>
    
    <style>
        :root {
            --bg: #0d1115;
            --sidebar: #161b22;
            --card: #1e272e;
            --green: #2ecc71;
            --gold: #f1c40f;
            --red: #e74c3c;
            --blue: #3498db;
            --text: #ecf0f1;
            --text-muted: #8b949e;
            --border: #30363d;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: grid;
            grid-template-columns: 280px 1fr;
            height: 100vh;
            overflow: hidden;
        }

        /* BARRA LATERAL */
        aside {
            background-color: var(--sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 10px;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--text);
            text-transform: uppercase;
            margin-bottom: 20px;
            letter-spacing: 1px;
        }
        .brand span { color: var(--green); }

        .nav-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 12px;
            text-align: left;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.2s;
            display: flex; align-items: center; gap: 10px;
        }
        .nav-btn:hover { background: var(--card); color: #fff; border-color: #fff; }
        .nav-btn.active { background: var(--green); color: #0d1115; border-color: var(--green); }

        /* CONTE√öDO PRINCIPAL */
        main {
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        /* CABE√áALHO */
        header {
            background: rgba(22, 27, 34, 0.95);
            padding: 20px 40px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky; top: 0; z-index: 10;
        }

        .team-profile { display: flex; align-items: center; gap: 15px; }
        .team-crest { width: 60px; height: 60px; object-fit: contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }
        .team-details h2 { margin: 0; font-size: 1.4rem; }
        .team-details p { margin: 0; color: var(--text-muted); font-size: 0.9rem; }

        .game-info { text-align: right; }
        .year-badge { background: var(--card); padding: 5px 15px; border-radius: 20px; border: 1px solid var(--border); font-weight: bold; }

        /* GRID DO DASHBOARD */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            padding: 40px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%; box-sizing: border-box;
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: 20px;
            display: flex; flex-direction: column;
        }

        /* CARD DO PR√ìXIMO JOGO */
        .match-card {
            background: linear-gradient(160deg, #1e272e 0%, #161b22 100%);
            border-top: 4px solid var(--green);
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .match-header { font-size: 0.8rem; text-transform: uppercase; color: var(--gold); letter-spacing: 2px; margin-bottom: 20px; }
        
        .scoreboard { display: flex; align-items: center; gap: 30px; margin-bottom: 30px; width: 100%; justify-content: center; }
        .team-display { display: flex; flex-direction: column; align-items: center; width: 120px; }
        .big-crest { width: 90px; height: 90px; object-fit: contain; margin-bottom: 10px; transition: transform 0.3s; }
        .big-crest:hover { transform: scale(1.1); }
        .vs-tag { font-size: 1.5rem; font-weight: 900; color: #555; }

        .play-btn {
            background: var(--green);
            color: #000;
            border: none;
            padding: 15px 50px;
            font-size: 1.1rem;
            font-weight: 800;
            border-radius: 50px;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
            transition: 0.2s;
        }
        .play-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(46, 204, 113, 0.5); }
        .play-btn:disabled { background: #444; color: #888; cursor: not-allowed; transform: none; box-shadow: none; }

        /* TABELA DE ELENCO */
        .squad-card { height: 600px; overflow: hidden; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .table-container { overflow-y: auto; height: 100%; }
        
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: var(--text-muted); font-size: 0.75rem; padding: 10px; position: sticky; top: 0; background: var(--card); text-transform: uppercase; }
        td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.9rem; vertical-align: middle; }
        
        .pos-tag { background: #333; padding: 3px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; width: 35px; text-align: center; display: inline-block; }
        .trait-tag { color: var(--blue); font-size: 0.8rem; font-style: italic; }

        /* BARRINHA DE SA√öDE */
        .health-bar-container { width: 100%; background: #333; height: 6px; border-radius: 3px; overflow: hidden; margin-top: 5px; }
        .health-bar-fill { height: 100%; border-radius: 3px; transition: width 0.3s; }

        /* FINAN√áAS */
        .finance-item { margin-bottom: 15px; }
        .finance-label { font-size: 0.8rem; color: var(--text-muted); }
        .finance-value { font-size: 1.5rem; font-weight: bold; color: var(--text); }
        .positive { color: var(--green); }
        
        /* FIM DE TEMPORADA */
        .season-end { display: none; text-align: center; padding: 40px; }
        .season-end h1 { color: var(--gold); }

    </style>
</head>
<body>

    <aside>
        <div class="brand">BR<span>Futebol</span></div>
        <button class="nav-btn active">üè† Vis√£o Geral</button>
        <button class="nav-btn" onclick="window.location.href='escalacao.html'">üëï Escala√ß√£o</button>
        <button class="nav-btn" onclick="window.location.href='mercado.html'">üí∏ Mercado</button>
        <button class="nav-btn" onclick="window.location.href='central-competicoes.html'">üèÜ Tabelas</button>
        <button class="nav-btn" onclick="window.location.href='financeiro.html'">üí∞ Finan√ßas</button>
    </aside>

    <main>
        <header>
            <div class="team-profile">
                <img id="header-escudo" class="team-crest" src="" onerror="this.src='https://cdn-icons-png.flaticon.com/512/53/53283.png'">
                <div class="team-details">
                    <h2 id="header-time">Carregando...</h2>
                    <p id="header-tecnico">Treinador</p>
                </div>
            </div>
            <div class="game-info">
                <div class="year-badge">Temporada <span id="header-ano">2026</span></div>
            </div>
        </header>

        <div class="dashboard-grid">
            
            <div style="display: flex; flex-direction: column; gap: 25px;">
                
                <div class="card match-card" id="card-proximo-jogo">
                    <div class="match-header" id="match-competition">Brasileir√£o - Rodada 1</div>
                    <div class="scoreboard">
                        <div class="team-display">
                            <img id="home-logo" class="big-crest">
                            <span id="home-name" style="font-weight:bold; margin-top:5px;">Casa</span>
                        </div>
                        <div class="vs-tag">VS</div>
                        <div class="team-display">
                            <img id="away-logo" class="big-crest">
                            <span id="away-name" style="font-weight:bold; margin-top:5px;">Fora</span>
                        </div>
                    </div>
                    <button class="play-btn" onclick="jogarPartida()">JOGAR PARTIDA</button>
                </div>

                <div class="card match-card season-end" id="card-fim-temporada">
                    <h1>FIM DE TEMPORADA</h1>
                    <p style="margin-bottom:20px; color:#aaa;">O ano acabou. Prepare-se para a renova√ß√£o de contratos, aposentadorias e o sorteio do novo calend√°rio.</p>
                    <button class="play-btn" style="background:var(--gold); color:#000;" onclick="virarTemporada()">INICIAR NOVA TEMPORADA</button>
                </div>

                <div class="card squad-card">
                    <div class="card-header">
                        <span style="font-weight:bold; color:var(--green);">ELENCO PRINCIPAL</span>
                        <span style="font-size:0.8rem; color:#aaa;" id="squad-count">0 Jogadores</span>
                    </div>
                    <div class="table-container">
                        <table id="squad-table">
                            <thead>
                                <tr>
                                    <th style="width:50px;">POS</th>
                                    <th>NOME</th>
                                    <th>IDADE</th>
                                    <th>OVR</th>
                                    <th>CARAC.</th> <th>SAL√ÅRIO</th>
                                    <th style="width:80px;">SA√öDE</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div style="display: flex; flex-direction: column; gap: 25px;">
                
                <div class="card">
                    <div class="card-header">FINAN√áAS</div>
                    <div class="finance-item">
                        <div class="finance-label">Saldo em Caixa</div>
                        <div class="finance-value positive" id="fin-caixa">R$ 0</div>
                    </div>
                    <div class="finance-item">
                        <div class="finance-label">Folha Salarial (M√™s)</div>
                        <div class="finance-value" id="fin-folha" style="color:#fff;">R$ 0</div>
                    </div>
                </div>

                <div class="card" style="flex-grow: 1;">
                    <div class="card-header">DIRETORIA</div>
                    <p style="color:#aaa; font-size:0.9rem; line-height: 1.6;">
                        A diretoria espera um bom desempenho. Fique atento √† sa√∫de dos jogadores veteranos, eles cansam mais r√°pido!
                    </p>
                    <hr style="border:0; border-top:1px solid #333; margin: 15px 0;">
                    <div style="font-size:0.85rem; color:#888; display:flex; flex-direction:column; gap:10px;">
                        <div>üü¢ Sa√∫de > 80%: Ideal para jogar</div>
                        <div>üü° Sa√∫de < 80%: Risco de les√£o leve</div>
                        <div>üî¥ Sa√∫de < 60%: <b>POUPE O JOGADOR!</b></div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        let gameState;
        let meuTime;

        window.onload = function() {
            // 1. Carrega o jogo salvo
            gameState = Engine.carregarJogo();
            if (!gameState) {
                window.location.href = 'index.html'; 
                return;
            }

            // 2. Busca o time do usu√°rio no Engine
            meuTime = Engine.encontrarTime(gameState, gameState.meuTime);
            
            // Tratamento de erro
            if (!meuTime) {
                alert("Erro: Time n√£o encontrado. Inicie um novo jogo.");
                window.location.href = 'index.html';
                return;
            }

            // 3. Renderiza a tela
            atualizarHeader();
            atualizarProximoJogo();
            atualizarElenco();
            atualizarFinancas();
        };

        function atualizarHeader() {
            document.getElementById('header-time').innerText = meuTime.nome;
            document.getElementById('header-escudo').src = meuTime.escudo;
            document.getElementById('header-tecnico').innerText = localStorage.getItem('brfutebol_tecnico') || "T√©cnico";
            document.getElementById('header-ano').innerText = gameState.ano;
        }

        function atualizarProximoJogo() {
            const semana = gameState.semanaAtual - 1;
            const evento = gameState.calendarioUsuario[semana];

            if (!evento) {
                document.getElementById('card-proximo-jogo').style.display = 'none';
                document.getElementById('card-fim-temporada').style.display = 'flex';
                return;
            }

            document.getElementById('match-competition').innerText = `${evento.nome} (${evento.tipo})`;

            const jogo = evento.jogos.find(j => j.casa === meuTime.nome || j.fora === meuTime.nome);

            if (jogo) {
                const souCasa = jogo.casa === meuTime.nome;
                const nomeAdv = souCasa ? jogo.fora : jogo.casa;
                const advObj = Engine.encontrarTime(gameState, nomeAdv);

                document.getElementById('home-name').innerText = jogo.casa;
                document.getElementById('away-name').innerText = jogo.fora;

                const escudoAdv = advObj ? advObj.escudo : 'https://cdn-icons-png.flaticon.com/512/53/53283.png';
                
                if (souCasa) {
                    document.getElementById('home-logo').src = meuTime.escudo;
                    document.getElementById('away-logo').src = escudoAdv;
                } else {
                    document.getElementById('home-logo').src = escudoAdv;
                    document.getElementById('away-logo').src = meuTime.escudo;
                }
            } else {
                document.getElementById('home-name').innerText = "FOLGA";
                document.getElementById('home-logo').src = "";
                document.getElementById('away-name').innerText = "---";
                document.getElementById('away-logo').src = "";
                const btn = document.querySelector('.play-btn');
                btn.innerText = "SIMULAR SEMANA (FOLGA)";
            }
        }

        function atualizarElenco() {
            const tbody = document.querySelector('#squad-table tbody');
            tbody.innerHTML = '';
            document.getElementById('squad-count').innerText = `${meuTime.elenco.length} Jogadores`;

            const ordemPos = { 'GOL': 1, 'ZAG': 2, 'LD': 3, 'LE': 3, 'VOL': 4, 'MEI': 5, 'ATA': 6 };
            
            meuTime.elenco.sort((a, b) => {
                const posA = ordemPos[a.pos] || 99;
                const posB = ordemPos[b.pos] || 99;
                if (posA !== posB) return posA - posB;
                return b.forca - a.forca;
            });

            meuTime.elenco.forEach(jog => {
                let corOvr = '#fff';
                if (jog.forca >= 80) corOvr = 'var(--green)';
                else if (jog.forca >= 75) corOvr = 'var(--gold)';

                const saude = jog.saude !== undefined ? jog.saude : 100;
                let corBarra = '#2ecc71'; 
                if(saude < 80) corBarra = '#f1c40f'; 
                if(saude < 60) corBarra = '#e74c3c';

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><span class="pos-tag">${jog.pos}</span></td>
                    <td style="font-weight:500;">${jog.nome}</td>
                    <td style="color:#888;">${jog.idade}</td>
                    <td style="color:${corOvr}; font-weight:bold;">${jog.forca}</td>
                    <td class="trait-tag">${jog.carac || '-'}</td>
                    <td style="color:#aaa; font-family:monospace; font-size:0.8rem;">${Engine.formatarDinheiro(jog.salario)}</td>
                    <td>
                        <div class="health-bar-container" title="Sa√∫de: ${Math.floor(saude)}%">
                            <div class="health-bar-fill" style="width:${saude}%; background-color:${corBarra};"></div>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function atualizarFinancas() {
            if (!meuTime.financas) Engine.inicializarFinancas(meuTime);
            
            document.getElementById('fin-caixa').innerText = Engine.formatarDinheiro(meuTime.financas.caixa);
            const folhaMensal = Math.floor(meuTime.financas.despesas.folhaSalarial / 12);
            document.getElementById('fin-folha').innerText = Engine.formatarDinheiro(folhaMensal);
        }

        function jogarPartida() {
            const btn = document.querySelector('.play-btn');
            
            if(btn.innerText.includes("FOLGA")) {
                btn.disabled = true;
                btn.innerText = "SIMULANDO...";
                setTimeout(() => {
                    Engine.processarSemana(gameState);
                    window.location.reload();
                }, 1000);
            } else {
                window.location.href = 'partida.html';
            }
        }

        function virarTemporada() {
            if (confirm("Deseja encerrar o ano e iniciar a pr√≥xima temporada? Os jogadores v√£o envelhecer e evoluir.")) {
                Engine.virarTemporada(gameState);
                alert("Feliz Ano Novo! Temporada atualizada.");
                window.location.reload();
            }
        }
    </script>
</body>
</html>
