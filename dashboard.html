<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRFutebol - Central do Clube</title>
    <script src="engine.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-dark: #0f1216;
            --sidebar-bg: #161b22;
            --card-bg: #1e2329;
            --neon-green: #00ff88;
            --text-main: #ffffff;
            --text-muted: #8b949e;
            --border: #30363d;
            --gold: #f1c40f;
            --red: #ff4757;
            --blue: #3498db;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0; padding: 0;
            display: flex; height: 100vh; overflow: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            width: 250px; background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            padding: 20px; display: flex; flex-direction: column; gap: 10px; flex-shrink: 0;
        }
        .logo {
            font-family: 'Rajdhani', sans-serif; font-size: 2rem; font-weight: 900;
            margin-bottom: 20px; color: #fff; text-transform: uppercase; letter-spacing: 2px;
        }
        .logo span { color: var(--neon-green); }
        .menu-btn {
            display: flex; align-items: center; gap: 12px; padding: 12px;
            border-radius: 8px; color: var(--text-muted); text-decoration: none;
            font-weight: 600; transition: 0.2s; cursor: pointer;
        }
        .menu-btn:hover, .menu-btn.active { background: rgba(0, 255, 136, 0.1); color: var(--neon-green); }
        .menu-btn.logout { margin-top: auto; color: var(--red); }
        .menu-btn.logout:hover { background: rgba(255, 71, 87, 0.1); }

        /* MAIN CONTENT */
        .main-content {
            flex: 1; padding: 30px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 25px;
        }

        /* HEADER INFO */
        .top-bar {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--card-bg); padding: 15px 25px; border-radius: 12px;
            border: 1px solid var(--border);
        }
        .club-title h1 { margin: 0; font-family: 'Rajdhani'; font-size: 2rem; text-transform: uppercase; }
        .club-title span { color: var(--text-muted); font-size: 0.9rem; letter-spacing: 1px; }
        .finances {
            display: flex; gap: 20px;
        }
        .stat-badge {
            background: #0d1117; padding: 8px 15px; border-radius: 6px; border: 1px solid var(--border);
            text-align: right;
        }
        .stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; display: block; }
        .stat-val { font-family: 'Rajdhani'; font-weight: 700; font-size: 1.2rem; color: var(--neon-green); }

        /* MATCHDAY BANNER (PR√ìXIMO JOGO) */
        .match-banner {
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1522770179533-24471fcdba45?q=80&w=1000&auto=format&fit=crop');
            background-size: cover; background-position: center;
            border-radius: 16px; border: 1px solid var(--border);
            padding: 30px; display: flex; align-items: center; justify-content: space-between;
            position: relative; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .match-info-center { display: flex; flex-direction: column; align-items: center; z-index: 2; }
        .match-label { font-family: 'Rajdhani'; font-weight: 700; color: var(--neon-green); letter-spacing: 2px; margin-bottom: 10px; }
        .vs-teams { display: flex; align-items: center; gap: 40px; }
        .team-display { display: flex; flex-direction: column; align-items: center; gap: 10px; width: 120px; }
        .team-logo-big { 
            width: 80px; height: 80px; object-fit: contain; 
            filter: drop-shadow(0 0 15px rgba(255,255,255,0.2)); 
            transition: transform 0.3s;
        }
        .team-logo-big:hover { transform: scale(1.1); }
        .team-name-big { font-weight: 800; font-size: 1.1rem; text-align: center; line-height: 1.2; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
        .vs-text { font-family: 'Rajdhani'; font-size: 3rem; font-weight: 900; color: #fff; text-shadow: 0 0 20px rgba(0,0,0,0.5); }
        
        .play-btn {
            background: var(--neon-green); color: #000; border: none;
            padding: 15px 40px; border-radius: 30px; font-family: 'Rajdhani';
            font-weight: 800; font-size: 1.2rem; cursor: pointer; text-transform: uppercase;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.4); transition: 0.2s;
            z-index: 2; margin-top: 15px;
        }
        .play-btn:hover { transform: scale(1.05); box-shadow: 0 0 30px rgba(0, 255, 136, 0.6); }
        .play-btn:disabled { background: #555; cursor: not-allowed; box-shadow: none; }

        /* SQUAD SECTION */
        .section-header {
            display: flex; justify-content: space-between; align-items: flex-end;
            margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px;
        }
        .section-title { font-family: 'Rajdhani'; font-size: 1.5rem; font-weight: 700; color: #fff; }
        
        /* TABELA DE ELENCO */
        .squad-table-container {
            background: var(--card-bg); border: 1px solid var(--border);
            border-radius: 12px; overflow: hidden;
        }
        .squad-table { width: 100%; border-collapse: collapse; }
        .squad-table th {
            text-align: left; background: rgba(0,0,0,0.3); color: var(--text-muted);
            padding: 12px 15px; font-size: 0.8rem; text-transform: uppercase; font-weight: 700;
        }
        .squad-table td {
            padding: 12px 15px; border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.9rem; vertical-align: middle;
        }
        .squad-table tr:hover { background: rgba(255,255,255,0.03); }
        .squad-table tr:last-child td { border-bottom: none; }

        /* Colunas Espec√≠ficas */
        .col-pos { width: 60px; }
        .pos-badge {
            font-size: 0.75rem; font-weight: 800; padding: 4px 8px; border-radius: 4px;
            text-align: center; color: #000; min-width: 40px; display: inline-block;
        }
        .pos-gol { background-color: #f1c40f; } /* Amarelo */
        .pos-def { background-color: #3498db; color: #fff; } /* Azul */
        .pos-mei { background-color: #2ecc71; } /* Verde */
        .pos-ata { background-color: #ff4757; color: #fff; } /* Vermelho */

        .col-name { font-weight: 600; color: #fff; }
        .col-ovr { width: 60px; font-family: 'Rajdhani'; font-weight: 800; font-size: 1.2rem; color: var(--gold); text-align: center; }
        
        .col-cond { width: 150px; }
        .condition-bar-bg { width: 100%; height: 6px; background: #333; border-radius: 3px; overflow: hidden; }
        .condition-bar-fill { height: 100%; border-radius: 3px; transition: width 0.3s; }

        .col-status { width: 100px; text-align: center; font-size: 0.8rem; color: #888; }

        /* RESPONSIVO */
        @media (max-width: 768px) {
            .match-banner { flex-direction: column; text-align: center; gap: 20px; }
            .vs-teams { gap: 20px; }
            .play-btn { width: 100%; }
        }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="logo">BR<span>FUTEBOL</span></div>
        <a class="menu-btn active">üìä Vis√£o Geral</a>
        <a class="menu-btn" href="escalacao.html">üëï Escala√ß√£o</a>
        <a class="menu-btn" href="calendario.html">üìÖ Calend√°rio</a>
        <a class="menu-btn" onclick="alert('Em breve: Mercado da Bola')">üí∞ Transfer√™ncias</a>
        <a class="menu-btn" onclick="alert('Em breve: Finan√ßas')">üè¶ Clube</a>
        <a class="menu-btn logout" onclick="sair()">‚úñ Sair</a>
    </nav>

    <main class="main-content">
        
        <div class="top-bar">
            <div class="club-title">
                <h1 id="team-name">Carregando...</h1>
                <span id="coach-name">Treinador: ---</span>
            </div>
            <div class="finances">
                <div class="stat-badge">
                    <span class="stat-label">Or√ßamento</span>
                    <span class="stat-val" id="money-display">R$ 0M</span>
                </div>
                <div class="stat-badge">
                    <span class="stat-label">Rodada Atual</span>
                    <span class="stat-val" id="round-display">--</span>
                </div>
            </div>
        </div>

        <div class="match-banner" id="match-banner">
            <h2 style="margin:auto">Carregando Calend√°rio...</h2>
        </div>

        <div>
            <div class="section-header">
                <div class="section-title">Elenco Principal</div>
                <button onclick="window.location.href='escalacao.html'" style="background:none; border:1px solid #444; color:#888; padding:5px 15px; border-radius:4px; cursor:pointer;">Gerenciar T√°tica</button>
            </div>
            
            <div class="squad-table-container">
                <table class="squad-table">
                    <thead>
                        <tr>
                            <th class="col-pos">Pos</th>
                            <th>Nome</th>
                            <th class="col-ovr">OVR</th>
                            <th class="col-cond">Condi√ß√£o F√≠sica</th>
                            <th class="col-status">Status</th>
                        </tr>
                    </thead>
                    <tbody id="squad-body">
                        </tbody>
                </table>
            </div>
        </div>

    </main>

    <script>
        // Imagem padr√£o caso o escudo quebre
        const DEFAULT_SHIELD = "https://cdn-icons-png.flaticon.com/512/53/53283.png";

        window.onload = function() {
            // Carrega o jogo
            const game = Engine.carregarJogo();
            if (!game || !game.info) {
                alert("Erro: Nenhum jogo salvo encontrado.");
                window.location.href = 'index.html';
                return;
            }

            // 1. Preencher Topo
            document.getElementById('team-name').innerText = game.info.time;
            document.getElementById('coach-name').innerText = "Manager: " + game.info.tecnico;
            document.getElementById('money-display').innerText = "R$ " + (game.recursos.dinheiro / 1000000).toFixed(1) + " Mi";
            document.getElementById('round-display').innerText = game.rodadaAtual;

            // 2. Preencher Pr√≥ximo Jogo
            renderizarMatchDay(game);

            // 3. Preencher Elenco
            renderizarElencoPro(game);
        };

        function renderizarMatchDay(game) {
            const container = document.getElementById('match-banner');
            const rodadaIndex = game.rodadaAtual - 1;

            // Verifica fim de temporada
            if (!game.calendario || !game.calendario[rodadaIndex]) {
                container.innerHTML = `
                    <div style="text-align:center; width:100%">
                        <h2 style="font-family:'Rajdhani'; font-size:3rem;">FIM DE TEMPORADA</h2>
                        <p>Aguarde a atualiza√ß√£o de ano (Em breve)</p>
                    </div>
                `;
                return;
            }

            // Acha o jogo do usu√°rio
            const jogos = game.calendario[rodadaIndex].jogos;
            const meuJogo = jogos.find(j => j.mandante === game.info.time || j.visitante === game.info.time);

            if (meuJogo) {
                // Tenta achar os objetos dos times para pegar escudo (se poss√≠vel)
                // Aqui usamos a fun√ß√£o simples de string ou busca basica
                const mandanteObj = Engine.encontrarTime(meuJogo.mandante) || { escudo: DEFAULT_SHIELD };
                const visitanteObj = Engine.encontrarTime(meuJogo.visitante) || { escudo: DEFAULT_SHIELD };

                container.innerHTML = `
                    <div class="team-display">
                        <img src="${mandanteObj.escudo || DEFAULT_SHIELD}" class="team-logo-big" onerror="this.src='${DEFAULT_SHIELD}'">
                        <div class="team-name-big">${meuJogo.mandante}</div>
                    </div>

                    <div class="match-info-center">
                        <div class="match-label">BRASILEIR√ÉO ‚Ä¢ RODADA ${game.rodadaAtual}</div>
                        <div class="vs-text">VS</div>
                        <button class="play-btn" onclick="irParaEstadio()">IR PARA O JOGO</button>
                    </div>

                    <div class="team-display">
                        <img src="${visitanteObj.escudo || DEFAULT_SHIELD}" class="team-logo-big" onerror="this.src='${DEFAULT_SHIELD}'">
                        <div class="team-name-big">${meuJogo.visitante}</div>
                    </div>
                `;
            } else {
                // Folga
                container.innerHTML = `
                    <div style="text-align:center; width:100%">
                        <h2>FOLGA NA RODADA</h2>
                        <button class="play-btn" onclick="simularFolga()">SIMULAR RESTO DA RODADA</button>
                    </div>
                `;
            }
        }

        function renderizarElencoPro(game) {
            const tbody = document.getElementById('squad-body');
            tbody.innerHTML = "";

            // Pega o time do usu√°rio
            let meuTime = null;
            if(Engine.getMeuTime) meuTime = Engine.getMeuTime();
            else meuTime = game.times.find(t => t.nome === game.info.time);

            if (!meuTime || !meuTime.elenco || meuTime.elenco.length === 0) {
                tbody.innerHTML = "<tr><td colspan='5' style='text-align:center; padding:20px'>Elenco n√£o encontrado.</td></tr>";
                return;
            }

            // Ordena: Goleiros > Defesa > Meio > Ataque
            const ordemPos = { 'GOL': 1, 'ZAG': 2, 'LD': 3, 'LE': 3, 'VOL': 4, 'MEI': 5, 'ATA': 6 };
            meuTime.elenco.sort((a,b) => (ordemPos[a.pos]||99) - (ordemPos[b.pos]||99) || b.forca - a.forca);

            meuTime.elenco.forEach(jog => {
                const forca = jog.forca || 60;
                const saude = jog.saude !== undefined ? jog.saude : 100;
                
                // Define cor da posi√ß√£o
                let posClass = "";
                if(jog.pos === 'GOL') posClass = "pos-gol";
                else if(['ZAG','LD','LE'].includes(jog.pos)) posClass = "pos-def";
                else if(['VOL','MEI'].includes(jog.pos)) posClass = "pos-mei";
                else posClass = "pos-ata";

                // Define cor da barra de vida
                let barColor = "#2ecc71"; // Verde
                if(saude < 80) barColor = "#f1c40f"; // Amarelo
                if(saude < 50) barColor = "#ff4757"; // Vermelho

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><span class="pos-badge ${posClass}">${jog.pos}</span></td>
                    <td class="col-name">${jog.nome}</td>
                    <td class="col-ovr">${forca}</td>
                    <td>
                        <div class="condition-bar-bg">
                            <div class="condition-bar-fill" style="width:${saude}%; background-color:${barColor}"></div>
                        </div>
                    </td>
                    <td class="col-status">${saude === 100 ? 'Apto' : (saude < 50 ? 'Cansado' : 'Normal')}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Fun√ß√£o do Bot√£o de Ir para o Jogo
        function irParaEstadio() {
            const game = Engine.carregarJogo();
            const rodadaIndex = game.rodadaAtual - 1;
            const jogos = game.calendario[rodadaIndex].jogos;
            
            // Acha o jogo
            const meuJogo = jogos.find(j => j.mandante === game.info.time || j.visitante === game.info.time);
            
            if (meuJogo) {
                const adversario = meuJogo.mandante === game.info.time ? meuJogo.visitante : meuJogo.mandante;
                localStorage.setItem('brfutebol_oponente_atual', adversario);
                window.location.href = 'partida.html';
            }
        }

        function simularFolga() {
            alert("Avan√ßando calend√°rio...");
            // L√≥gica futura de simula√ß√£o r√°pida
        }

        function sair() {
            if(confirm("Voltar ao menu inicial?")) window.location.href = 'index.html';
        }
    </script>
</body>
</html>
