<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRFutebol - Central do Clube</title>
    <script src="engine.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-dark: #0f1216;
            --sidebar-bg: #161b22;
            --card-bg: #1e2329;
            --neon-green: #00ff88;
            --text-main: #ffffff;
            --text-muted: #8b949e;
            --border: #30363d;
            --gold: #f1c40f;
            --red: #ff4757;
            --blue: #3498db;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0; padding: 0;
            display: flex; height: 100vh; overflow: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            width: 250px; background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            padding: 20px; display: flex; flex-direction: column; gap: 10px; flex-shrink: 0;
        }
        .logo {
            font-family: 'Rajdhani', sans-serif; font-size: 2rem; font-weight: 900;
            margin-bottom: 20px; color: #fff; text-transform: uppercase; letter-spacing: 2px;
        }
        .logo span { color: var(--neon-green); }
        .menu-btn {
            display: flex; align-items: center; gap: 12px; padding: 12px;
            border-radius: 8px; color: var(--text-muted); text-decoration: none;
            font-weight: 600; transition: 0.2s; cursor: pointer;
        }
        .menu-btn:hover, .menu-btn.active { background: rgba(0, 255, 136, 0.1); color: var(--neon-green); }
        .menu-btn.logout { margin-top: auto; color: var(--red); }
        .menu-btn.logout:hover { background: rgba(255, 71, 87, 0.1); }

        /* MAIN CONTENT */
        .main-content {
            flex: 1; padding: 30px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 25px;
        }

        /* HEADER INFO */
        .top-bar {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--card-bg); padding: 15px 25px; border-radius: 12px;
            border: 1px solid var(--border);
        }
        .club-title h1 { margin: 0; font-family: 'Rajdhani'; font-size: 2rem; text-transform: uppercase; }
        .club-title span { color: var(--text-muted); font-size: 0.9rem; letter-spacing: 1px; }
        .finances { display: flex; gap: 20px; }
        .stat-badge {
            background: #0d1117; padding: 8px 15px; border-radius: 6px; border: 1px solid var(--border);
            text-align: right;
        }
        .stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; display: block; }
        .stat-val { font-family: 'Rajdhani'; font-weight: 700; font-size: 1.2rem; color: var(--neon-green); }

        /* MATCHDAY BANNER - NOVA IMAGEM DE FUNDO AQUI */
        .match-banner {
            /* Fundo escuro gradiente + Nova imagem de torcida vibrante */
            background: linear-gradient(to bottom, rgba(15, 18, 22, 0.85), rgba(15, 18, 22, 0.95)), url('https://images.unsplash.com/photo-1508098682722-e99c43a406b2?q=80&w=1000&auto=format&fit=crop');
            background-size: cover; background-position: center center;
            
            border-radius: 16px; border: 1px solid var(--border);
            padding: 40px; min-height: 280px; 
            display: flex; align-items: center; justify-content: center;
            position: relative; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }
        
        .match-content-grid {
            display: grid; grid-template-columns: 1fr auto 1fr; 
            width: 100%; max-width: 800px; 
            align-items: center; justify-items: center; z-index: 2;
        }

        .match-info-center { display: flex; flex-direction: column; align-items: center; text-align: center; }
        .match-label { font-family: 'Rajdhani'; font-weight: 700; color: var(--neon-green); letter-spacing: 3px; margin-bottom: 5px; font-size: 0.9rem; text-transform: uppercase; }
        
        .team-display { display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .team-logo-big { 
            width: 110px; height: 110px; object-fit: contain; 
            filter: drop-shadow(0 0 20px rgba(255,255,255,0.1)); 
            transition: transform 0.3s;
        }
        .team-logo-big:hover { transform: scale(1.1); filter: drop-shadow(0 0 25px rgba(0, 255, 136, 0.4)); }
        .team-name-big { font-family: 'Rajdhani'; font-weight: 800; font-size: 1.4rem; text-align: center; color: #fff; text-shadow: 0 2px 10px rgba(0,0,0,0.8); }
        
        .vs-text { font-family: 'Rajdhani'; font-size: 4rem; font-weight: 900; color: #fff; opacity: 0.8; margin: 0 40px; font-style: italic; }
        
        .play-btn {
            background: linear-gradient(45deg, var(--neon-green), #27ae60);
            color: #000; border: none;
            padding: 18px 50px; border-radius: 40px; font-family: 'Rajdhani';
            font-weight: 900; font-size: 1.3rem; cursor: pointer; text-transform: uppercase;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3); transition: 0.3s;
            margin-top: 20px; letter-spacing: 1px;
        }
        .play-btn:hover { transform: scale(1.05); box-shadow: 0 0 50px rgba(0, 255, 136, 0.6); color: #fff; }
        .play-btn:disabled { background: #444; cursor: not-allowed; box-shadow: none; color: #888; }

        /* SQUAD SECTION */
        .section-header {
            display: flex; justify-content: space-between; align-items: flex-end;
            margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px;
        }
        .section-title { font-family: 'Rajdhani'; font-size: 1.5rem; font-weight: 700; color: #fff; }
        
        /* TABELA DE ELENCO */
        .squad-table-container {
            background: var(--card-bg); border: 1px solid var(--border);
            border-radius: 12px; overflow: hidden;
        }
        .squad-table { width: 100%; border-collapse: collapse; }
        .squad-table th {
            text-align: left; background: rgba(0,0,0,0.3); color: var(--text-muted);
            padding: 15px 10px; font-size: 0.8rem; text-transform: uppercase; font-weight: 700;
        }
        .squad-table td {
            padding: 12px 10px; border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.9rem; vertical-align: middle;
        }
        .squad-table tr:hover { background: rgba(255,255,255,0.03); }
        .squad-table tr:last-child td { border-bottom: none; }

        /* Colunas Espec√≠ficas */
        .col-pos { width: 50px; text-align: center; }
        .pos-badge {
            font-size: 0.75rem; font-weight: 800; padding: 4px 0; border-radius: 4px;
            text-align: center; color: #000; width: 40px; display: inline-block;
        }
        .pos-gol { background-color: #f1c40f; } 
        .pos-def { background-color: #3498db; color: #fff; } 
        .pos-mei { background-color: #2ecc71; } 
        .pos-ata { background-color: #ff4757; color: #fff; } 

        .col-name { font-weight: 600; color: #fff; font-size: 1rem; }
        .col-ovr { width: 50px; font-family: 'Rajdhani'; font-weight: 800; font-size: 1.2rem; color: var(--gold); text-align: center; }
        
        /* Colunas de Atributos */
        .col-stat { width: 40px; text-align: center; font-family: 'Rajdhani'; font-weight: 600; color: #ccc; font-size: 0.9rem; }
        .stat-high { color: var(--neon-green); font-weight: 700; }
        .stat-low { color: #555; }

        .col-carac { width: 120px; }
        .carac-badge {
            font-size: 0.7rem; font-weight: 600; color: #aaa;
            background: rgba(255,255,255,0.05); padding: 3px 8px; border-radius: 4px;
            display: inline-block; border: 1px solid rgba(255,255,255,0.1); white-space: nowrap;
        }

        .col-cond { width: 100px; }
        .condition-bar-bg { width: 100%; height: 6px; background: #333; border-radius: 3px; overflow: hidden; }
        .condition-bar-fill { height: 100%; border-radius: 3px; transition: width 0.3s; }

        @media (max-width: 900px) {
            .col-stat { display: none; }
            .match-content-grid { grid-template-columns: 1fr; gap: 30px; }
            .vs-text { margin: 10px 0; transform: rotate(90deg); font-size: 2rem; }
            .play-btn { width: 100%; }
        }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="logo">BR<span>FUTEBOL</span></div>
        <a class="menu-btn active">üìä Vis√£o Geral</a>
        <a class="menu-btn" href="escalacao.html">üëï Escala√ß√£o</a>
        <a class="menu-btn" href="calendario.html">üìÖ Calend√°rio</a>
        <a class="menu-btn" onclick="alert('Em breve: Mercado da Bola')">üí∞ Transfer√™ncias</a>
        <a class="menu-btn" onclick="alert('Em breve: Finan√ßas')">üè¶ Clube</a>
        <a class="menu-btn logout" onclick="sair()">‚úñ Sair</a>
    </nav>

    <main class="main-content">
        
        <div class="top-bar">
            <div class="club-title">
                <h1 id="team-name">Carregando...</h1>
                <span id="coach-name">Treinador: ---</span>
            </div>
            <div class="finances">
                <div class="stat-badge">
                    <span class="stat-label">Or√ßamento</span>
                    <span class="stat-val" id="money-display">R$ 0M</span>
                </div>
                <div class="stat-badge">
                    <span class="stat-label">Rodada Atual</span>
                    <span class="stat-val" id="round-display">--</span>
                </div>
            </div>
        </div>

        <div class="match-banner" id="match-banner">
            <h2 style="margin:auto">Carregando Calend√°rio...</h2>
        </div>

        <div>
            <div class="section-header">
                <div class="section-title">Elenco Principal</div>
                <button onclick="window.location.href='escalacao.html'" style="background:none; border:1px solid #444; color:#888; padding:8px 20px; border-radius:6px; cursor:pointer; font-weight:600; font-size:0.9rem; transition:0.2s;">Gerenciar T√°tica ‚öôÔ∏è</button>
            </div>
            
            <div class="squad-table-container">
                <table class="squad-table">
                    <thead>
                        <tr>
                            <th class="col-pos">Pos</th>
                            <th>Nome</th>
                            <th class="col-ovr">OVR</th>
                            <th class="col-stat" title="Velocidade">PAC</th>
                            <th class="col-stat" title="Finaliza√ß√£o">SHO</th>
                            <th class="col-stat" title="Passe">PAS</th>
                            <th class="col-stat" title="Drible">DRI</th>
                            <th class="col-stat" title="Defesa">DEF</th>
                            <th class="col-stat" title="F√≠sico">PHY</th>
                            <th class="col-carac">Carac.</th>
                            <th class="col-cond">Condi√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody id="squad-body">
                        </tbody>
                </table>
            </div>
        </div>

    </main>

    <script>
        const DEFAULT_SHIELD = "https://cdn-icons-png.flaticon.com/512/53/53283.png";

        window.onload = function() {
            const game = Engine.carregarJogo();
            if (!game || !game.info) {
                alert("Erro: Nenhum jogo salvo encontrado.");
                window.location.href = 'index.html';
                return;
            }

            document.getElementById('team-name').innerText = game.info.time;
            document.getElementById('coach-name').innerText = "Manager: " + game.info.tecnico;
            document.getElementById('money-display').innerText = "R$ " + (game.recursos.dinheiro / 1000000).toFixed(1) + " Mi";
            document.getElementById('round-display').innerText = game.rodadaAtual;

            renderizarMatchDay(game);
            renderizarElencoPro(game);
        };

        function renderizarMatchDay(game) {
            const container = document.getElementById('match-banner');
            const rodadaIndex = game.rodadaAtual - 1;

            if (!game.calendario || !game.calendario[rodadaIndex]) {
                container.innerHTML = `
                    <div style="text-align:center; width:100%">
                        <h2 style="font-family:'Rajdhani'; font-size:3rem; margin:0;">FIM DE TEMPORADA</h2>
                        <p style="color:#aaa;">Aguarde a atualiza√ß√£o de ano (Em breve)</p>
                    </div>
                `;
                return;
            }

            const jogos = game.calendario[rodadaIndex].jogos;
            const meuJogo = jogos.find(j => j.mandante === game.info.time || j.visitante === game.info.time);

            if (meuJogo) {
                const mandanteObj = Engine.encontrarTime(meuJogo.mandante) || { escudo: DEFAULT_SHIELD };
                const visitanteObj = Engine.encontrarTime(meuJogo.visitante) || { escudo: DEFAULT_SHIELD };

                container.innerHTML = `
                    <div class="match-content-grid">
                        <div class="team-display">
                            <img src="${mandanteObj.escudo || DEFAULT_SHIELD}" class="team-logo-big" onerror="this.src='${DEFAULT_SHIELD}'">
                            <div class="team-name-big">${meuJogo.mandante}</div>
                        </div>

                        <div class="match-info-center">
                            <div class="match-label">BRASILEIR√ÉO ‚Ä¢ RODADA ${game.rodadaAtual}</div>
                            <div class="vs-text">VS</div>
                            <button class="play-btn" onclick="irParaEstadio()">IR PARA O EST√ÅDIO</button>
                        </div>

                        <div class="team-display">
                            <img src="${visitanteObj.escudo || DEFAULT_SHIELD}" class="team-logo-big" onerror="this.src='${DEFAULT_SHIELD}'">
                            <div class="team-name-big">${meuJogo.visitante}</div>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div style="text-align:center; width:100%">
                        <h2>FOLGA NA RODADA</h2>
                        <button class="play-btn" style="background:#444; color:#fff;" onclick="simularFolga()">SIMULAR RODADA</button>
                    </div>
                `;
            }
        }

        function renderizarElencoPro(game) {
            const tbody = document.getElementById('squad-body');
            tbody.innerHTML = "";

            let meuTime = null;
            if(Engine.getMeuTime) meuTime = Engine.getMeuTime();
            else meuTime = game.times.find(t => t.nome === game.info.time);

            if (!meuTime || !meuTime.elenco || meuTime.elenco.length === 0) {
                tbody.innerHTML = "<tr><td colspan='11' style='text-align:center; padding:20px'>Elenco n√£o encontrado.</td></tr>";
                return;
            }

            const ordemPos = { 'GOL': 1, 'ZAG': 2, 'LD': 3, 'LE': 3, 'VOL': 4, 'MEI': 5, 'ATA': 6 };
            meuTime.elenco.sort((a,b) => (ordemPos[a.pos]||99) - (ordemPos[b.pos]||99) || b.forca - a.forca);

            meuTime.elenco.forEach(jog => {
                const forca = jog.forca || 60;
                const saude = jog.saude !== undefined ? jog.saude : 100;
                const atr = garantirAtributos(jog);
                const caracteristica = jog.caracteristica || jog.carac || "-";

                let posClass = "";
                if(jog.pos === 'GOL') posClass = "pos-gol";
                else if(['ZAG','LD','LE'].includes(jog.pos)) posClass = "pos-def";
                else if(['VOL','MEI'].includes(jog.pos)) posClass = "pos-mei";
                else posClass = "pos-ata";

                let barColor = "#2ecc71"; 
                if(saude < 80) barColor = "#f1c40f"; 
                if(saude < 50) barColor = "#ff4757"; 

                const fmtStat = (val) => {
                    if(val >= 80) return `<span class="stat-high">${val}</span>`;
                    if(val < 60) return `<span class="stat-low">${val}</span>`;
                    return val;
                };

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><span class="pos-badge ${posClass}">${jog.pos}</span></td>
                    <td class="col-name">${jog.nome}</td>
                    <td class="col-ovr">${forca}</td>
                    
                    <td class="col-stat">${fmtStat(atr.VEL)}</td>
                    <td class="col-stat">${fmtStat(atr.FIN)}</td>
                    <td class="col-stat">${fmtStat(atr.PAS)}</td>
                    <td class="col-stat">${fmtStat(atr.DRI)}</td>
                    <td class="col-stat">${fmtStat(atr.DEF)}</td>
                    <td class="col-stat">${fmtStat(atr.FIS)}</td>

                    <td class="col-carac"><span class="carac-badge">${caracteristica}</span></td>
                    <td>
                        <div class="condition-bar-bg" title="${saude}%">
                            <div class="condition-bar-fill" style="width:${saude}%; background-color:${barColor}"></div>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function garantirAtributos(jog) {
            if(jog.atributos && jog.atributos.VEL) return jog.atributos;

            const base = jog.forca || 60;
            if(jog.pos === 'GOL') {
                return { VEL: base+2, FIN: base-5, PAS: base, DRI: base-10, DEF: base+5, FIS: base };
            } else if (jog.pos === 'ATA') {
                return { VEL:base+5, FIN:base+5, PAS:base-5, DRI:base+5, DEF:base-30, FIS:base };
            } else if (['ZAG','LD','LE'].includes(jog.pos)) {
                return { VEL:base, FIN:base-20, PAS:base-5, DRI:base-10, DEF:base+5, FIS:base+5 };
            } else { 
                return { VEL:base, FIN:base-5, PAS:base+5, DRI:base, DEF:base, FIS:base };
            }
        }

        function irParaEstadio() {
            const game = Engine.carregarJogo();
            const rodadaIndex = game.rodadaAtual - 1;
            const jogos = game.calendario[rodadaIndex].jogos;
            const meuJogo = jogos.find(j => j.mandante === game.info.time || j.visitante === game.info.time);
            
            if (meuJogo) {
                const adversario = meuJogo.mandante === game.info.time ? meuJogo.visitante : meuJogo.mandante;
                localStorage.setItem('brfutebol_oponente_atual', adversario);
                window.location.href = 'partida.html';
            }
        }

        function simularFolga() {
            alert("Avan√ßando calend√°rio...");
        }

        function sair() {
            if(confirm("Voltar ao menu inicial?")) window.location.href = 'index.html';
        }
    </script>
</body>
</html>
