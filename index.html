<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>O Rei da Várzea — Protótipo</title>
<style>
  :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}
  body{margin:0;background:#f5f7fb;color:#111}
  header{background:#0b6bd6;color:#fff;padding:14px 18px}
  .container{max-width:1100px;margin:18px auto;padding:10px}
  .card{background:#fff;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06);padding:16px;margin-bottom:16px;}
  label{display:block;margin-top:8px}
  input[type=text], select{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px}
  button{background:#0b6bd6;color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
  button[disabled]{opacity:0.5;cursor:default}
  .row{display:flex;gap:12px}
  .col{flex:1}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
  th{background:#fafafa;position:sticky;top:0}
  .inline-muted{color:#666;font-size:13px}
  .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .pitch{width:100%;height:420px;background:linear-gradient(#73c26b,#5eb95e);border-radius:12px;padding:12px;box-sizing:border-box;position:relative}
  .position-slot{width:90px;height:40px;border-radius:6px;background:rgba(255,255,255,0.9);display:flex;align-items:center;justify-content:center;cursor:pointer;margin:6px}
  .bench{display:flex;flex-direction:column;gap:6px;max-height:260px;overflow:auto;padding:8px;border:1px dashed #ccc;border-radius:8px}
  .player-card{padding:8px;border-radius:8px;background:#fff;border:1px solid #eee;margin-bottom:6px;cursor:grab;display:flex;justify-content:space-between;align-items:center}
  .muted{color:#666;font-size:13px}
  .flex{display:flex;gap:8px;align-items:center}
  .center{display:flex;justify-content:center;align-items:center}
  @media(min-width:900px){ .row-lg{display:flex;gap:12px} }
</style>
</head>
<body>

<header>
  <div class="container">
    <h1>O Rei da Várzea — Protótipo</h1>
  </div>
</header>

<div class="container">

  <!-- Tela 1 -->
  <div id="tela1" class="card">
    <h2>Tela 1 — Cadastro</h2>
    <label>Nome do seu time
      <input id="teamName" type="text" placeholder="Ex: Os Meninos da Rua" />
    </label>
    <label>Seu nome
      <input id="userName" type="text" placeholder="Seu nome" />
    </label>
    <label>Cidade
      <input id="cityName" type="text" placeholder="Cidade" />
    </label>
    <div style="margin-top:12px" class="controls">
      <button id="btnToTela2" disabled>Contratar jogadores</button>
      <div class="inline-muted">Preencha todos os campos para habilitar.</div>
    </div>
  </div>

  <!-- Tela 2 -->
  <div id="tela2" class="card" style="display:none">
    <h2>Tela 2 — Mercado de Jogadores</h2>
    <div class="row">
      <div class="col">
        <div class="card">
          <div class="row" style="align-items:center">
            <div>
              <strong>Dinheiro em caixa:</strong>
              <div id="cashDisplay" style="font-size:18px">R$ 5.000</div>
              <div class="muted">Elenco <span id="selectedCount">0</span>/22</div>
            </div>
            <div style="margin-left:auto" class="controls">
              <button id="btnEscalar" disabled>Escalar time</button>
            </div>
          </div>
        </div>
        <div style="margin-top:10px;overflow:auto;max-height:520px">
          <table id="playersTable">
            <thead>
              <tr>
                <th>Nome</th>
                <th>Posição</th>
                <th>Pé</th>
                <th>Idade</th>
                <th>Salário</th>
                <th>Contratar</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Tela 3 -->
  <div id="tela3" class="card" style="display:none">
    <h2>Tela 3 — Escalação</h2>
    <div class="row-lg">
      <div style="flex:1">
        <div class="card">
          <h3>Escalação (arraste do banco para a posição)</h3>
          <div class="pitch" id="pitch">
            <div style="display:flex;flex-wrap:wrap;justify-content:center">
              <div class="position-slot" data-pos="GK" data-posLabel="GK" ondrop="dropHandler(event)" ondragover="allowDrop(event)" id="slot-GK">GK</div>
            </div>
            <div style="display:flex;justify-content:space-between;margin-top:12px">
              <div class="position-slot" data-pos="LB" data-posLabel="LB" ondrop="dropHandler(event)" ondragover="allowDrop(event)" id="slot-LB">LB</div>
              <div class="position-slot" data-pos="CB1" data-posLabel="CB" ondrop="dropHandler(event)" ondragover="allowDrop(event)" id="slot-CB1">CB</div>
              <div class="position-slot" data-pos="CB2" data-posLabel="CB" ondrop="dropHandler(event)" ondragover="allowDrop(event)" id="slot-CB2">CB</div>
              <div class="position-slot" data-pos="RB" data-posLabel="RB" ondrop="dropHandler(event)" ondragover="allowDrop(event)" id="slot-RB">RB</div>
            </div>
            <div style="display:flex;justify-content:space-around;margin-top:12px">
              <div class="position-slot" data-pos="DM" data-posLabel="VOL" ondrop="dropHandler(event)" ondragover="allowDrop(event)" id="slot-DM">VOL</div>
              <div class="position-slot" data-pos="CM1" data-posLabel="MEI" ondrop="dropHandler(event)" ondragover="allowDrop(event)" id="slot-CM1">MEI</div>
              <div class="position-slot" data-pos="CM2" data-posLabel="MEI" ondrop="dropHandler(event)" ondragover="allowDrop(event)" id="slot-CM2">MEI</div>
            </div>
            <div style="display:flex;justify-content:space-between;margin-top:12px">
              <div class="position-slot" data-pos="LW" data-posLabel="AE" ondrop="dropHandler(event)" ondragover="allowDrop(event)" id="slot-LW">AE</div>
              <div class="position-slot" data-pos="ST" data-posLabel="ATA" ondrop="dropHandler(event)" ondragover="allowDrop(event)" id="slot-ST">ATA</div>
              <div class="position-slot" data-pos="RW" data-posLabel="AD" ondrop="dropHandler(event)" ondragover="allowDrop(event)" id="slot-RW">AD</div>
            </div>
          </div>
        </div>
        <div style="margin-top:10px" class="controls">
          <button id="btnPlayMatch" disabled>Jogar partida</button>
        </div>
      </div>

      <div style="width:320px">
        <div class="card">
          <h3>Banco / Jogadores contratados</h3>
          <div class="bench" id="bench"></div>
          <div style="margin-top:10px" class="controls">
            <button id="btnBackToMarket">Voltar ao Mercado</button>
            <div class="muted" style="margin-left:auto">Arraste para escalar. Clique para desassociar.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tela 4 -->
  <div id="tela4" class="card" style="display:none">
    <h2>Partida em andamento</h2>
    <div class="row-lg">
      <div style="flex:1">
        <h3 id="userTeamName">Meu Time</h3>
        <ul id="jogadoresUsuario"></ul>
      </div>
      <div style="flex:2;text-align:center">
        <h2 id="placar">0 x 0</h2>
        <div id="comentarios" style="text-align:left;max-height:300px;overflow:auto;border:1px solid #ddd;border-radius:6px;padding:10px"></div>
      </div>
      <div style="flex:1">
        <h3>Vila Freitas</h3>
        <ul id="jogadoresVila"></ul>
      </div>
    </div>
  </div>

</div>

<script>
let CASH = 5000;
const MAX_PLAYERS = 22;
const TOTAL_MARKET = 42;

const teamName = document.getElementById('teamName');
const userName = document.getElementById('userName');
const cityName = document.getElementById('cityName');
const btnToTela2 = document.getElementById('btnToTela2');

const tela1 = document.getElementById('tela1');
const tela2 = document.getElementById('tela2');
const tela3 = document.getElementById('tela3');
const tela4 = document.getElementById('tela4');

const cashDisplay = document.getElementById('cashDisplay');
const selectedCountEl = document.getElementById('selectedCount');
const playersTbody = document.querySelector('#playersTable tbody');
const btnEscalar = document.getElementById('btnEscalar');
const btnPlayMatch = document.getElementById('btnPlayMatch');

const bench = document.getElementById('bench');
const btnBackToMarket = document.getElementById('btnBackToMarket');

const jogadoresUsuario = document.getElementById("jogadoresUsuario");
const jogadoresVila = document.getElementById("jogadoresVila");
const placar = document.getElementById("placar");
const comentarios = document.getElementById("comentarios");
const userTeamNameEl = document.getElementById("userTeamName");

let players = [];
let hired = [];

function formatReal(n) { return 'R$ ' + n.toLocaleString('pt-BR'); }
function updateCash() { cashDisplay.textContent = formatReal(CASH); }
function updateSelectedCount() { selectedCountEl.textContent = hired.length; }

function validateTela1() {
  btnToTela2.disabled = !(teamName.value.trim() && userName.value.trim() && cityName.value.trim());
}

teamName.addEventListener('input', validateTela1);
userName.addEventListener('input', validateTela1);
cityName.addEventListener('input', validateTela1);

btnToTela2.addEventListener('click', () => {
  tela1.style.display = 'none';
  tela2.style.display = 'block';
});

const firsts = [
  "Marrentinho", "Juscelino", "Ronaldinho", "Berg", "Tico", "Zeca", "GarrinchaJr",
  "Xandão", "Pedrinho", "Claudinho", "Sandro", "Marollo", "Ricardão", "RonaldoDoBairro",
  "Toninho", "Juca", "Beto", "Paulozinho", "Nininho", "Cabeludo", "Juninho", "Neto",
  "Biro-Biro", "Casemirozinho", "Liminha", "Giba", "Fabão", "Fredinho", "Rubi", "Magrão",
  "Marcelinho", "Cascavel", "ZéMoleque", "Dado", "Cabeça", "Guga", "Fumaça", "Papagaio",
  "Zezinho", "Dinho", "Pintinho", "Gerson", "Carlinhos", "Tatu", "Foguinho"
];
const lastParts = ["Carioca", "Paranaense", "Paulista", "Baiano", "Gaucho", "Mineiro", "Nordestino", "Pernambucano", "Capixaba", "Catarinense"];
const distribution = {
  GK: 4,
  ZAG: 8,
  LAT: 8,
  VOL: 6,
  MEI: 8,
  ATA: 8
};
function pickFoot() {
  const r = Math.random() * 100;
  if (r < 10) return 'Ambidestro';
  if (r < 70) return 'Direito';
  return 'Esquerdo';
}
function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

function generatePlayers() {
  players = [];
  const buckets = [];
  Object.keys(distribution).forEach(k => {
    for (let i = 0; i < distribution[k]; i++) buckets.push(k);
  });
  while (buckets.length < TOTAL_MARKET) buckets.push('MEI');

  for (let i = 0; i < TOTAL_MARKET; i++) {
    const posKey = buckets[i];
    let posLabel = '';
    switch (posKey) {
      case 'GK': posLabel = 'Goleiro'; break;
      case 'ZAG': posLabel = 'Zagueiro'; break;
      case 'LAT': posLabel = 'Lateral'; break;
      case 'VOL': posLabel = 'Volante'; break;
      case 'MEI': posLabel = 'Meia'; break;
      case 'ATA': posLabel = 'Atacante'; break;
      default: posLabel = 'Meia/Atacante';
    }
    const fname = firsts[i % firsts.length] + ' ' + lastParts[i % lastParts.length];
    const age = randInt(16, 45);
    const salary = Math.round(randInt(10, 200) / 10) * 10;
    const foot = pickFoot();
    players.push({
      id: 'p' + i,
      name: fname,
      pos: posLabel,
      foot,
      age,
      salary,
    });
  }
}

function renderMarket() {
  playersTbody.innerHTML = '';
  players.forEach(p => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><strong>${p.name}</strong><div class="muted">${p.pos}</div></td>
      <td>${p.pos}</td>
      <td>${p.foot}</td>
      <td>${p.age}</td>
      <td>${formatReal(p.salary)}</td>
      <td style="width:120px"><label style="display:flex;align-items:center;gap:8px;cursor:pointer">
        <input type="checkbox" data-id="${p.id}" />
        <span class="muted">Contratar</span>
      </label></td>
    `;
    playersTbody.appendChild(tr);
  });

  initEventListeners();
  syncCheckboxes();
}

function initEventListeners() {
    document.querySelectorAll('#playersTable input[type=checkbox]').forEach(cb => {
        cb.addEventListener('change', (ev) => {
            const id = cb.dataset.id;
            const ply = players.find(x => x.id === id);

            if (cb.checked) {
                if (hired.length >= MAX_PLAYERS) {
                    alert('Você já selecionou 22 jogadores (limite).');
                    cb.checked = false;
                    return;
                }
                if (CASH - ply.salary < 0) {
                    alert('Saldo insuficiente para contratar este jogador.');
                    cb.checked = false;
                    return;
                }
                CASH -= ply.salary;
                hired.push(ply);
            } else {
                CASH += ply.salary;
                hired = hired.filter(x => x.id !== id);
            }

            updateCash();
            updateSelectedCount();
            syncCheckboxes();
        });
    });
}

function syncCheckboxes() {
    const allCheckboxes = document.querySelectorAll('#playersTable input[type=checkbox]');
    const hiredIds = hired.map(p => p.id);

    allCheckboxes.forEach(cb => {
        const playerId = cb.dataset.id;
        const isHired = hiredIds.includes(playerId);

        cb.checked = isHired;

        if (hired.length >= MAX_PLAYERS && !isHired) {
            cb.disabled = true;
        } else {
            cb.disabled = false;
            const player = players.find(p => p.id === playerId);
            if (player && CASH - player.salary < 0) {
                cb.disabled = true;
            }
        }
    });

    btnEscalar.disabled = (hired.length !== MAX_PLAYERS);
}

btnEscalar.addEventListener('click', () => {
  if (hired.length !== MAX_PLAYERS) {
    alert('Você precisa contratar 22 jogadores para escalar o time.');
    return;
  }
  tela2.style.display = 'none';
  tela3.style.display = 'block';
  populateBench();
});

btnBackToMarket.addEventListener('click', () => {
  tela3.style.display = 'none';
  tela2.style.display = 'block';
});

function populateBench() {
  bench.innerHTML = '';
  hired.forEach(p => {
    const div = document.createElement('div');
    div.className = 'player-card';
    div.id = 'bench-' + p.id;
    div.draggable = true;
    div.dataset.pid = p.id;
    div.dataset.pos = p.pos;
    div.innerHTML = `<div><strong>${p.name}</strong><div class="muted">${p.pos} • ${p.foot} • ${p.age} anos</div></div>
                     <div class="muted">${formatReal(p.salary)}</div>`;
    div.addEventListener('dragstart', dragStart);
    bench.appendChild(div);

    // Clique para desassociar
    div.addEventListener('click', () => {
      const occupied = document.querySelectorAll('[data-assigned]');
      occupied.forEach(slot => {
        if (slot.dataset.assigned === p.id) {
          slot.textContent = slot.dataset.posLabel || '';
          delete slot.dataset.assigned;
          const card = document.getElementById('bench-' + p.id);
          card.style.background = "#fff";
          card.style.cursor = "grab";
          card.draggable = true;
        }
      });
    });
  });
}

function allowDrop(ev) { ev.preventDefault(); }
function dragStart(ev) {
  ev.dataTransfer.setData("text/plain", ev.target.dataset.pid);
}
function dropHandler(ev) {
  ev.preventDefault();
  const pid = ev.dataTransfer.getData("text/plain");
  const slot = ev.currentTarget;
  const p = hired.find(x => x.id === pid);

  // Verifica se já foi escalado
  if (document.querySelector(`[data-assigned='${pid}']`)) {
    alert(`${p.name} já está escalado!`);
    return;
  }

  // Regras de posição
  const slotPos = slot.dataset.pos;
  let allowed = false;

  if (slotPos === "GK" && p.pos === "Goleiro") allowed = true;
  if ((slotPos.startsWith("CB") || slotPos === "LB" || slotPos === "RB") && (p.pos === "Zagueiro" || p.pos === "Lateral")) allowed = true;
  if (slotPos === "DM" && p.pos === "Volante") allowed = true;
  if ((slotPos.startsWith("CM") || slotPos === "LW" || slotPos === "RW") && p.pos === "Meia") allowed = true;
  if (slotPos === "ST" && p.pos === "Atacante") allowed = true;

  if (!allowed) {
    showMessage("Eu não sei jogar aí, professor!");
    return;
  }

  // Escala o jogador
  slot.dataset.assigned = pid;
  slot.textContent = p.name;

  const card = document.getElementById('bench-' + pid);
  card.style.background = "#ddd";
  card.style.cursor = "not-allowed";
  card.draggable = false;

  // Habilita botão de jogar se todos os slots tiverem alguém
  const filled = document.querySelectorAll('.position-slot[data-assigned]').length;
  if (filled >= 11) btnPlayMatch.disabled = false;
}

function showMessage(msg) {
  const box = document.createElement('div');
  box.textContent = msg;
  box.style.position = "fixed";
  box.style.top = "20px";
  box.style.right = "20px";
  box.style.background = "#ffefc2";
  box.style.color = "#333";
  box.style.padding = "10px 16px";
  box.style.border = "1px solid #e6b800";
  box.style.borderRadius = "8px";
  box.style.boxShadow = "0 4px 8px rgba(0,0,0,0.15)";
  document.body.appendChild(box);

  setTimeout(() => box.remove(), 2500);
}

// Botão Jogar Partida
btnPlayMatch.addEventListener("click", () => {
  tela3.style.display = "none";
  tela4.style.display = "block";
  userTeamNameEl.textContent = teamName.value || "Meu Time";

  // escalação usuário (11 escalados)
  jogadoresUsuario.innerHTML = "";
  document.querySelectorAll(".position-slot[data-assigned]").forEach(slot => {
    const id = slot.dataset.assigned;
    const p = hired.find(h => h.id === id);
    if (p) {
      const li = document.createElement("li");
      li.textContent = p.name + " (" + p.pos + ")";
      jogadoresUsuario.appendChild(li);
    }
  });

  // escalação vila freitas
  const escalaVila = ["João Goleiro", "Zé Zagueiro", "Marquinho Lateral", "Beto Zagueiro", "Tonho Lateral", "Carlinhos Volante", "Neto Meia", "Juninho Meia", "Paulinho Atacante", "Zezinho Atacante", "Didi Atacante"];
  jogadoresVila.innerHTML = "";
  escalaVila.forEach(j => {
    const li = document.createElement("li");
    li.textContent = j;
    jogadoresVila.appendChild(li);
  });

  // simulação
  placar.textContent = "0 x 0";
  comentarios.innerHTML = "<p><em>Apito inicial...</em></p>";
  let golsU=0,golsV=0,minuto=1;
  const lances=["Escanteio perigoso!","Falta dura no meio-campo.","Chutão pra fora, quase na arquibancada!",
    "Torcida grita 'é campeão!' sem motivo.","Juiz tropeçou na bola.","Goleiro saiu jogando errado.",
    "Zagueiro furou feio, risos na torcida.","Bola na trave!!!","Carrinho criminoso, juiz fingiu que não viu.",
    "Bandeirinha levantou a bandeira sem motivo."];

  const interval=setInterval(()=>{
    if(minuto>=60){
      clearInterval(interval);
      comentarios.innerHTML+="<p><strong>Fim de jogo!</strong></p>";
      return;
    }
    let lance=lances[Math.floor(Math.random()*lances.length)];
    if(Math.random()<0.15){
      if(Math.random()<0.5){golsU++;lance="GOOOOL do "+(teamName.value||"Meu Time")+"!!!";}
      else{golsV++;lance="GOOOOL da Vila Freitas!!!";}
      placar.textContent=golsU+" x "+golsV;
    }
    comentarios.innerHTML+=`<p>${minuto} min - ${lance}</p>`;
    comentarios.scrollTop=comentarios.scrollHeight;
    minuto+=6;
  },6000);
});

// Inicialização
generatePlayers();
renderMarket();
updateCash();
updateSelectedCount();

window.allowDrop = allowDrop;
window.dropHandler = dropHandler;
</script>
</body>
</html>
