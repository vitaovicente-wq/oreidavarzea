<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRFutebol - Estádio</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <script src="database.js"></script>
    <script src="calendario.js"></script>
    <script src="engine-core.js"></script>
    <script src="engine-contratos.js"></script>
    <script src="engine-mercado.js"></script>
    <script src="engine-eventos.js"></script>
    <script src="engine-match.js"></script>
    <script src="engine-treino.js"></script>
    <script src="engine-estadio.js"></script>

    <style>
        :root { --bg: #121212; --card: #1e1e24; --accent: #00ff88; --text: #fff; --border: #333; }
        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; height: 100vh; display: flex; flex-direction: column; }
        
        .header { height: 60px; background: #16161a; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        .back-btn { color: #ccc; text-decoration: none; border: 1px solid #444; padding: 5px 10px; border-radius: 4px; font-size: 0.9rem; }
        
        .container { flex: 1; display: grid; grid-template-columns: 1fr 450px; gap: 20px; padding: 20px; overflow: hidden; }
        
        /* VISUAL (ESQUERDA) */
        .visual-col { display: flex; flex-direction: column; gap: 20px; overflow-y: auto; }
        .hero { 
            height: 300px; background-size: cover; background-position: center; border-radius: 12px; position: relative; 
            display: flex; flex-direction: column; justify-content: flex-end; padding: 30px; border: 1px solid var(--border);
            background-image: linear-gradient(0deg, #121212 0%, rgba(0,0,0,0.3) 100%), url('https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/Pacaembu_%282972423853%29.jpg/1920px-Pacaembu_%282972423853%29.jpg');
        }
        .hero h1 { margin: 0; font-family: 'Rajdhani'; font-size: 3rem; line-height: 1; text-transform: uppercase; text-shadow: 0 4px 10px #000; }
        
        .status-badge { position: absolute; top: 20px; right: 20px; background: var(--accent); color: #000; padding: 5px 15px; font-weight: bold; border-radius: 4px; font-family: 'Rajdhani'; }
        .status-badge.obra { background: #ffa502; }
        .status-badge.aluguel { background: #3498db; color: #fff; }

        .sector-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .sector-card { background: var(--card); padding: 15px; border-radius: 8px; border: 1px solid var(--border); }
        .sector-card span { display: block; font-size: 0.8rem; color: #888; }
        .sector-card strong { font-size: 1.2rem; font-family: 'Rajdhani'; }

        /* CONTROLES (DIREITA) */
        .control-col { background: var(--card); border-left: 1px solid var(--border); display: flex; flex-direction: column; }
        
        .tabs { display: flex; border-bottom: 1px solid var(--border); }
        .tab { flex: 1; background: transparent; border: none; padding: 15px; color: #888; cursor: pointer; font-weight: bold; border-bottom: 3px solid transparent; }
        .tab.active { color: #fff; border-bottom-color: var(--accent); background: rgba(255,255,255,0.02); }

        .content { padding: 20px; flex: 1; overflow-y: auto; display: none; }
        .content.active { display: block; }

        /* INPUTS */
        .field { margin-bottom: 15px; }
        .field label { display: block; font-size: 0.85rem; color: #ccc; margin-bottom: 5px; }
        input[type=number], select { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 4px; }
        
        .rent-item { background: #111; padding: 15px; border: 1px solid #333; border-radius: 6px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .btn-rent { background: transparent; border: 1px solid var(--accent); color: var(--accent); padding: 5px 12px; cursor: pointer; border-radius: 4px; font-weight: bold; }
        .btn-rent:hover { background: var(--accent); color: #000; }

        .btn-main { width: 100%; background: var(--accent); color: #000; border: none; padding: 15px; font-weight: 800; cursor: pointer; text-transform: uppercase; font-family: 'Rajdhani'; font-size: 1.1rem; margin-top: 20px; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="header">
        <div style="font-family:'Rajdhani'; font-size:1.5rem; font-weight:bold;">BR<span>FUTEBOL</span></div>
        <a href="dashboard.html" class="back-btn">Voltar</a>
    </div>

    <div class="container">
        <div class="visual-col">
            <div class="hero">
                <div id="status-display" class="status-badge" style="display:none;"></div>
                <h1 id="std-name">...</h1>
                <p id="std-desc" style="color:#ccc;">Casa do Clube</p>
                <div style="margin-top:10px; font-weight:bold; color:var(--accent);">CAPACIDADE: <span id="std-cap">0</span></div>
            </div>

            <div class="sector-grid">
                <div class="sector-card"><span>Geral</span><strong id="sec-geral">0</strong></div>
                <div class="sector-card"><span>Cadeiras</span><strong id="sec-cad">0</strong></div>
                <div class="sector-card"><span>VIP</span><strong id="sec-vip">0</strong></div>
                <div class="sector-card"><span>Vagas</span><strong id="sec-park">0</strong></div>
            </div>
        </div>

        <div class="control-col">
            <div class="tabs">
                <button class="tab active" onclick="setTab('ingressos')">Ingressos</button>
                <button class="tab" onclick="setTab('reforma')">Expansão</button>
                <button class="tab" onclick="setTab('aluguel')">Aluguel</button>
            </div>

            <div id="tab-ingressos" class="content active">
                <div class="field"><label>Geral (R$)</label><input type="number" id="p-geral"></div>
                <div class="field"><label>Cadeiras (R$)</label><input type="number" id="p-cadeiras"></div>
                <div class="field"><label>VIP (R$)</label><input type="number" id="p-vip"></div>
                <div class="field"><label>Estacionamento (R$)</label><input type="number" id="p-park"></div>
                
                <div style="background:#111; padding:15px; border:1px dashed #444; margin-top:20px;">
                    <small>Renda Estimada</small>
                    <div style="font-size:1.5rem; color:var(--accent); font-weight:bold;" id="proj-renda">R$ 0,00</div>
                </div>
                <button class="btn-main" onclick="salvarPrecos()">Atualizar Preços</button>
            </div>

            <div id="tab-reforma" class="content">
                <p style="color:#aaa; font-size:0.9rem;">Amplie setores. Custo aprox: R$ 1 Mi a cada 1.000 lugares.</p>
                
                <div class="field">
                    <label>+ Lugares Geral</label>
                    <select id="add-geral" onchange="calcObra()">
                        <option value="0">0</option>
                        <option value="1000">+1.000</option>
                        <option value="5000">+5.000</option>
                        <option value="10000">+10.000</option>
                    </select>
                </div>
                
                <div class="field">
                    <label>+ Lugares Cadeiras</label>
                    <select id="add-cadeiras" onchange="calcObra()">
                        <option value="0">0</option>
                        <option value="1000">+1.000</option>
                        <option value="5000">+5.000</option>
                    </select>
                </div>

                <div class="field">
                    <label>+ Lugares VIP</label>
                    <select id="add-vip" onchange="calcObra()">
                        <option value="0">0</option>
                        <option value="100">+100</option>
                        <option value="500">+500</option>
                        <option value="1000">+1.000</option>
                    </select>
                </div>

                <div class="field">
                    <label>+ Vagas Estacionamento</label>
                    <select id="add-park" onchange="calcObra()">
                        <option value="0">0</option>
                        <option value="100">+100</option>
                        <option value="500">+500</option>
                        <option value="1000">+1.000</option>
                    </select>
                </div>
                
                <div style="background:#111; padding:15px; border-left:4px solid #ffa502;">
                    <div style="display:flex; justify-content:space-between;"><span>Custo:</span><strong id="obra-custo" style="color:#fff;">R$ 0</strong></div>
                    <div style="display:flex; justify-content:space-between;"><span>Tempo:</span><strong id="obra-tempo" style="color:#fff;">0 Rodadas</strong></div>
                </div>
                <button class="btn-main" style="background:#ffa502;" onclick="iniciarObra()">Iniciar Obras</button>
            </div>

            <div id="tab-aluguel" class="content">
                
                <div style="background:#222; padding:15px; border-radius:6px; margin-bottom:20px;">
                    <label style="color:var(--accent); font-weight:bold; display:block; margin-bottom:5px;">Duração do Contrato</label>
                    <select id="rent-duration" style="background:#000; border:1px solid #444; color:#fff; font-weight:bold;">
                        <option value="1">1 Jogo em Casa (Emergência)</option>
                        <option value="3">3 Jogos em Casa (Curto)</option>
                        <option value="5">5 Jogos em Casa (Médio)</option>
                        <option value="10">10 Jogos em Casa (Temporada)</option>
                    </select>
                    <small style="color:#888; display:block; margin-top:5px;">O valor do aluguel é pago por jogo realizado.</small>
                </div>

                <div id="lista-aluguel"></div>
            </div>
        </div>
    </div>

    <script>
        let dados = null;

        window.onload = function() {
            if(typeof Engine === 'undefined') return;
            const game = Engine.carregarJogo();
            dados = Engine.Estadios.getEstadio();

            // Renderiza Infos
            document.getElementById('std-name').innerText = dados.nome;
            document.getElementById('std-cap').innerText = dados.capacidade.toLocaleString();
            document.getElementById('sec-geral').innerText = dados.setores.geral.toLocaleString();
            document.getElementById('sec-cad').innerText = dados.setores.cadeiras.toLocaleString();
            document.getElementById('sec-vip').innerText = dados.setores.vip.toLocaleString();
            document.getElementById('sec-park').innerText = dados.setores.estacionamento.toLocaleString();

            // Status Badge
            const badge = document.getElementById('status-display');
            if(dados.emObras) {
                badge.style.display = 'block'; badge.className = 'status-badge obra'; badge.innerText = `EM OBRAS (${dados.rodadasObras} rod)`;
            } else if(dados.alugado) {
                badge.style.display = 'block'; badge.className = 'status-badge aluguel'; 
                badge.innerHTML = `ALUGADO: ${dados.alugado.nome}<br><small>Restam ${dados.alugado.jogosRestantes} jogos</small>`;
                document.getElementById('std-name').innerText = dados.alugado.nome + " (Alugado)";
            }

            // Inputs Preços
            document.getElementById('p-geral').value = dados.precos.geral;
            document.getElementById('p-cadeiras').value = dados.precos.cadeiras;
            document.getElementById('p-vip').value = dados.precos.vip;
            document.getElementById('p-park').value = dados.precos.estacionamento;

            // Lista Aluguel
            const lista = Engine.Estadios.listarEstadiosDisponiveis();
            const divLista = document.getElementById('lista-aluguel');
            lista.forEach(e => {
                divLista.innerHTML += `
                    <div class="rent-item">
                        <div>
                            <div style="font-weight:bold;">${e.nome}</div>
                            <small>Cap: ${e.cap.toLocaleString()} | ${formatMoney(e.aluguel)}/jogo</small>
                        </div>
                        <button class="btn-rent" onclick="alugar('${e.id}')">ASSINAR</button>
                    </div>
                `;
            });

            calcRenda();
        };

        function setTab(id) {
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-'+id).classList.add('active');
            event.target.classList.add('active');
        }

        function formatMoney(v) { return v.toLocaleString('pt-BR', {style:'currency', currency:'BRL'}); }

        // --- LÓGICA DE INTERFACE ---
        function calcRenda() {
            const p = {
                geral: parseInt(document.getElementById('p-geral').value),
                cadeiras: parseInt(document.getElementById('p-cadeiras').value),
                vip: parseInt(document.getElementById('p-vip').value),
                estacionamento: parseInt(document.getElementById('p-park').value)
            };
            Engine.Estadios.salvarPrecos(p);
            const sim = Engine.Estadios.calcularBilheteria({forca:70});
            Engine.Estadios._tempPrecos = null;
            document.getElementById('proj-renda').innerText = formatMoney(sim.rendaTotal);
        }

        function salvarPrecos() {
            const p = {
                geral: parseInt(document.getElementById('p-geral').value),
                cadeiras: parseInt(document.getElementById('p-cadeiras').value),
                vip: parseInt(document.getElementById('p-vip').value),
                estacionamento: parseInt(document.getElementById('p-park').value)
            };
            Engine.Estadios.salvarConfig(p);
            alert("Preços Salvos!");
        }

        function calcObra() {
            const add = {
                geral: parseInt(document.getElementById('add-geral').value),
                cadeiras: parseInt(document.getElementById('add-cadeiras').value),
                vip: parseInt(document.getElementById('add-vip').value),
                estacionamento: parseInt(document.getElementById('add-park').value)
            };
            const orc = Engine.Estadios.calcularOrcamento(add);
            document.getElementById('obra-custo').innerText = formatMoney(orc.custo);
            document.getElementById('obra-tempo').innerText = orc.tempo + " Rodadas";
        }

        function iniciarObra() {
            if(!confirm("Iniciar obra? O estádio ficará fechado.")) return;
            const add = {
                geral: parseInt(document.getElementById('add-geral').value),
                cadeiras: parseInt(document.getElementById('add-cadeiras').value),
                vip: parseInt(document.getElementById('add-vip').value),
                estacionamento: parseInt(document.getElementById('add-park').value)
            };
            const res = Engine.Estadios.iniciarReforma(add);
            alert(res.msg);
            if(res.sucesso) window.location.reload();
        }

        function alugar(id) {
            const lista = Engine.Estadios.listarEstadiosDisponiveis();
            const alvo = lista.find(e => e.id == id);
            const duracao = document.getElementById('rent-duration').value;

            if(confirm(`Alugar ${alvo.nome} por ${duracao} jogos em casa?`)) {
                const res = Engine.Estadios.assinarAluguel(alvo, duracao);
                alert(res.msg);
                if(res.sucesso) window.location.reload();
            }
        }
    </script>
</body>
</html>
