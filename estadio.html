<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRFutebol - Infraestrutura</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <script src="database.js"></script>
    <script src="calendario.js"></script>
    <script src="engine-core.js"></script>
    <script src="engine-contratos.js"></script>
    <script src="engine-mercado.js"></script>
    <script src="engine-eventos.js"></script>
    <script src="engine-match.js"></script>
    <script src="engine-treino.js"></script>
    <script src="engine-estadio.js"></script>

    <style>
        :root { 
            --bg-dark: #121212; 
            --panel-bg: #1e1e24;
            --panel-border: #2d2d35;
            --accent: #00ff88;
            --accent-dim: rgba(0, 255, 136, 0.1);
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --danger: #ff4757;
            --warning: #ffa502;
            --info: #3498db;
        }
        
        * { box-sizing: border-box; }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-dark); 
            color: var(--text-primary); 
            margin: 0; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
        }
        
        /* HEADER */
        .header { 
            height: 60px; 
            background: #16161a; 
            border-bottom: 1px solid var(--panel-border); 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding: 0 25px; 
            flex-shrink: 0;
        }
        .app-brand { font-family: 'Rajdhani'; font-weight: 700; font-size: 1.5rem; letter-spacing: 1px; }
        .app-brand span { color: var(--accent); }
        .btn-back { 
            background: transparent; border: 1px solid var(--panel-border); 
            color: var(--text-secondary); padding: 6px 14px; border-radius: 4px; 
            text-decoration: none; font-size: 0.85rem; transition: 0.2s; 
        }
        .btn-back:hover { border-color: var(--accent); color: var(--accent); }

        /* GRID PRINCIPAL (Fixa altura para permitir scroll interno) */
        .dashboard-grid { 
            flex: 1; 
            display: grid; 
            grid-template-columns: 1fr 420px; 
            gap: 20px; 
            padding: 20px; 
            overflow: hidden; /* Importante para o scroll funcionar dentro das colunas */
        }

        /* --- COLUNA ESQUERDA (VISUAL) --- */
        .visual-panel { 
            display: flex; flex-direction: column; gap: 15px; 
            overflow-y: auto; padding-right: 5px;
        }

        .hero-stadium { 
            min-height: 280px;
            background: linear-gradient(0deg, #121212 0%, rgba(18,18,18,0.5) 100%), 
                        url('https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/Pacaembu_%282972423853%29.jpg/1920px-Pacaembu_%282972423853%29.jpg');
            background-size: cover; background-position: center; 
            border-radius: 8px; border: 1px solid var(--panel-border); 
            position: relative; padding: 30px; 
            display: flex; flex-direction: column; justify-content: flex-end;
        }

        .status-badge { 
            position: absolute; top: 20px; right: 20px; 
            background: rgba(0,0,0,0.8); border: 1px solid var(--warning); 
            color: var(--warning); padding: 6px 12px; border-radius: 4px; 
            font-family: 'Rajdhani'; font-weight: 700; font-size: 0.9rem; text-transform: uppercase;
            backdrop-filter: blur(4px);
        }

        .stadium-meta h1 { 
            font-family: 'Rajdhani'; font-weight: 700; font-size: 2.5rem; 
            margin: 0; line-height: 1; text-transform: uppercase; 
            text-shadow: 0 4px 12px rgba(0,0,0,0.9);
        }
        .stadium-meta p { color: #ccc; margin: 5px 0 0 0; font-size: 1rem; }
        
        /* GRID DE INFRAESTRUTURA (FM STYLE) */
        .infra-stats { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; 
        }
        .stat-card { 
            background: var(--panel-bg); border: 1px solid var(--panel-border); 
            padding: 12px; border-radius: 6px; 
        }
        .stat-label { font-size: 0.7rem; color: var(--text-secondary); text-transform: uppercase; font-weight: 700; display: block; margin-bottom: 4px; }
        .stat-value { font-family: 'Rajdhani'; font-size: 1.1rem; font-weight: 700; color: #fff; }
        .stat-quality { font-size: 0.75rem; display: block; margin-top: 2px; }
        .q-high { color: var(--accent); }
        .q-med { color: var(--warning); }
        .q-low { color: var(--danger); }

        .sector-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        .sector-table td { padding: 8px; border-bottom: 1px solid var(--panel-border); color: #ccc; }
        .sector-table td:last-child { text-align: right; color: #fff; font-weight: bold; font-family: 'Rajdhani'; }
        .sector-table tr:last-child td { border-bottom: none; }

        /* --- COLUNA DIREITA (CONTROLES) --- */
        .control-panel { 
            background: var(--panel-bg); border: 1px solid var(--panel-border); 
            border-radius: 8px; display: flex; flex-direction: column; 
            overflow: hidden; height: 100%;
        }

        .tabs { display: flex; border-bottom: 1px solid var(--panel-border); background: #18181c; flex-shrink: 0; }
        .tab-btn { 
            flex: 1; background: transparent; border: none; padding: 15px; 
            color: var(--text-secondary); cursor: pointer; font-family: 'Rajdhani'; 
            font-weight: 700; font-size: 1rem; border-bottom: 3px solid transparent; transition: 0.2s;
        }
        .tab-btn:hover { background: rgba(255,255,255,0.03); color: #fff; }
        .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); background: rgba(0,255,136,0.05); }

        /* CONTE√öDO DAS ABAS */
        .tab-content { 
            padding: 20px; display: none; flex-direction: column; gap: 15px; 
            flex: 1; /* Ocupa o resto da altura */
            overflow-y: auto; /* Permite scroll se for grande */
        }
        .tab-content.visible { display: flex; }

        /* SCROLLBAR CUSTOMIZADA */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #121212; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }

        /* FORMUL√ÅRIOS */
        .form-group { margin-bottom: 10px; }
        .form-label { display: flex; justify-content: space-between; font-size: 0.85rem; color: #ccc; margin-bottom: 5px; }
        .form-input { 
            width: 100%; background: #121212; border: 1px solid #333; color: #fff; 
            padding: 10px; border-radius: 4px; font-family: 'Inter'; font-size: 0.9rem;
        }
        .form-input:focus { border-color: var(--accent); outline: none; }

        /* LISTA DE ALUGUEL (SCROLLABLE) */
        .rental-list-container {
            flex: 1; /* Ocupa todo espa√ßo dispon√≠vel */
            overflow-y: auto; /* Scroll aqui */
            padding-right: 5px;
            display: flex; flex-direction: column; gap: 10px;
        }

        .rent-card { 
            background: #151518; border: 1px solid #333; padding: 12px; border-radius: 6px; 
            display: flex; justify-content: space-between; align-items: center; transition: 0.2s;
        }
        .rent-card:hover { border-color: #555; background: #1a1a1d; }
        
        .rent-details div { font-weight: 700; color: #fff; font-size: 0.95rem; }
        .rent-details small { color: #777; font-size: 0.75rem; display: block; margin-top: 2px; }
        .rent-infra-tag { 
            display: inline-block; font-size: 0.65rem; padding: 2px 6px; 
            border-radius: 3px; margin-top: 4px; background: #222; border: 1px solid #444; color: #aaa;
        }

        .rent-price { text-align: right; }
        .rent-val { color: var(--accent); font-family: 'Rajdhani'; font-weight: 700; font-size: 1.1rem; }
        .btn-rent { 
            margin-top: 5px; background: transparent; border: 1px solid var(--accent); 
            color: var(--accent); padding: 4px 10px; border-radius: 3px; 
            cursor: pointer; font-size: 0.75rem; font-weight: 700; text-transform: uppercase;
        }
        .btn-rent:hover { background: var(--accent); color: #000; }

        .btn-main { 
            width: 100%; background: var(--accent); color: #000; border: none; padding: 14px; 
            font-family: 'Rajdhani'; font-weight: 700; font-size: 1.1rem; text-transform: uppercase; 
            cursor: pointer; margin-top: 10px; border-radius: 4px; flex-shrink: 0;
        }
        .btn-main.warning { background: var(--warning); }
        .btn-main:hover { filter: brightness(1.1); }

    </style>
</head>
<body>

    <header class="header">
        <div class="app-brand">BR<span>FUTEBOL</span></div>
        <a href="dashboard.html" class="btn-back">‚Üê Voltar</a>
    </header>

    <div class="dashboard-grid">
        
        <div class="visual-panel">
            <div class="hero-stadium">
                <div id="status-badge" class="status-badge" style="display:none;"></div>
                
                <div class="stadium-meta">
                    <h1 id="std-name">...</h1>
                    <p>Mando de Campo: <span id="team-name" style="color:#fff; font-weight:bold;">...</span></p>
                </div>
            </div>

            <div class="infra-stats">
                <div class="stat-card">
                    <span class="stat-label">Capacidade</span>
                    <span class="stat-value" id="std-cap">0</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Gramado</span>
                    <span class="stat-value">Natural</span>
                    <span class="stat-quality q-high" id="pitch-quality">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Instala√ß√µes</span>
                    <span class="stat-value">Modernas</span>
                    <span class="stat-quality q-high">Excelente</span>
                </div>
            </div>

            <div class="stat-card">
                <span class="stat-label" style="margin-bottom:10px;">Distribui√ß√£o de Assentos</span>
                <table class="sector-table">
                    <tr><td>Arquibancada Geral</td><td id="sec-geral">0</td></tr>
                    <tr><td>Cadeiras Numeradas</td><td id="sec-cad">0</td></tr>
                    <tr><td>Camarotes VIP</td><td id="sec-vip">0</td></tr>
                    <tr><td>Estacionamento</td><td id="sec-park">0</td></tr>
                </table>
            </div>
        </div>

        <div class="control-panel">
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('ingressos', this)">Bilheteria</button>
                <button class="tab-btn" onclick="switchTab('reforma', this)">Obras</button>
                <button class="tab-btn" onclick="switchTab('aluguel', this)">Aluguel</button>
            </div>

            <div id="tab-ingressos" class="tab-content visible">
                <div class="form-group"><div class="form-label"><span>Geral</span></div><input type="number" id="p-geral" class="form-input"></div>
                <div class="form-group"><div class="form-label"><span>Cadeiras</span></div><input type="number" id="p-cadeiras" class="form-input"></div>
                <div class="form-group"><div class="form-label"><span>VIP</span></div><input type="number" id="p-vip" class="form-input"></div>
                <div class="form-group"><div class="form-label"><span>Estacionamento</span></div><input type="number" id="p-park" class="form-input"></div>
                
                <div style="margin-top:auto; background:#121212; padding:15px; border:1px dashed #333; border-radius:6px;">
                    <span style="color:#777; font-size:0.8rem; text-transform:uppercase;">Receita Projetada (Lota√ß√£o M√©dia)</span>
                    <div style="font-size:1.4rem; color:var(--accent); font-family:'Rajdhani'; font-weight:700;" id="proj-renda">R$ 0,00</div>
                </div>
                <button class="btn-main" onclick="salvarPrecos()">Aplicar Pre√ßos</button>
            </div>

            <div id="tab-reforma" class="tab-content">
                <div style="padding:15px; background:rgba(255,165,2,0.1); border:1px solid var(--warning); border-radius:6px; font-size:0.85rem; color:#ddd;">
                    ‚ö†Ô∏è O est√°dio ficar√° fechado durante a reforma. Voc√™ precisar√° alugar outro campo.
                </div>

                <div class="form-group"><div class="form-label"><span>+ Geral</span></div>
                    <select id="add-geral" class="form-input" onchange="calcObra()"><option value="0">0</option><option value="1000">+1.000</option><option value="5000">+5.000</option><option value="10000">+10.000</option></select>
                </div>
                <div class="form-group"><div class="form-label"><span>+ Cadeiras</span></div>
                    <select id="add-cadeiras" class="form-input" onchange="calcObra()"><option value="0">0</option><option value="1000">+1.000</option><option value="5000">+5.000</option></select>
                </div>
                <div class="form-group"><div class="form-label"><span>+ VIP</span></div>
                    <select id="add-vip" class="form-input" onchange="calcObra()"><option value="0">0</option><option value="100">+100</option><option value="500">+500</option></select>
                </div>
                <div class="form-group"><div class="form-label"><span>+ Estacionamento</span></div>
                    <select id="add-park" class="form-input" onchange="calcObra()"><option value="0">0</option><option value="100">+100</option><option value="500">+500</option></select>
                </div>

                <div style="margin-top:auto; border-top:1px solid #333; padding-top:15px;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span style="color:#aaa;">Custo Estimado</span>
                        <span style="color:#fff; font-weight:bold;" id="obra-custo">R$ 0</span>
                    </div>
                    <div style="display:flex; justify-content:space-between;">
                        <span style="color:#aaa;">Tempo de Obra</span>
                        <span style="color:var(--warning); font-weight:bold;" id="obra-tempo">0 Rodadas</span>
                    </div>
                </div>
                <button class="btn-main warning" onclick="iniciarObra()">Iniciar Obras</button>
            </div>

            <div id="tab-aluguel" class="tab-content">
                <div style="background:#121212; padding:12px; border-radius:6px; border:1px solid #333;">
                    <label style="font-size:0.75rem; color:var(--accent); text-transform:uppercase; font-weight:bold;">Contrato</label>
                    <select id="rent-duration" style="width:100%; background:transparent; border:none; color:#fff; font-weight:bold; margin-top:5px; outline:none;">
                        <option value="1">1 Jogo em Casa</option>
                        <option value="3">3 Jogos em Casa</option>
                        <option value="5">5 Jogos em Casa</option>
                        <option value="10">10 Jogos (Temporada)</option>
                    </select>
                </div>

                <div id="lista-aluguel" class="rental-list-container">
                    </div>
            </div>

        </div>
    </div>

    <script>
        let dados = null;

        window.onload = function() {
            if(typeof Engine === 'undefined') return;
            const game = Engine.carregarJogo();
            dados = Engine.Estadios.getEstadio();

            document.getElementById('team-name').innerText = game.info.time;
            document.getElementById('std-name').innerText = dados.nome;
            document.getElementById('std-cap').innerText = dados.capacidade.toLocaleString();

            document.getElementById('sec-geral').innerText = dados.setores.geral.toLocaleString();
            document.getElementById('sec-cad').innerText = dados.setores.cadeiras.toLocaleString();
            document.getElementById('sec-vip').innerText = dados.setores.vip.toLocaleString();
            document.getElementById('sec-park').innerText = dados.setores.estacionamento.toLocaleString();

            // Status e Gramado
            const badge = document.getElementById('status-badge');
            const pitch = document.getElementById('pitch-quality');
            
            if(dados.emObras) {
                badge.style.display = 'block'; badge.innerText = `üöß EM OBRAS (${dados.rodadasObras}J)`;
                badge.style.borderColor = "var(--warning)"; badge.style.color = "var(--warning)";
            } else if(dados.alugado) {
                badge.style.display = 'block'; badge.innerText = `üìù ALUGADO (${dados.alugado.jogosRestantes}J)`;
                badge.style.borderColor = "var(--info)"; badge.style.color = "var(--info)";
                document.getElementById('std-name').innerText = dados.alugado.nome;
                pitch.innerText = "‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ"; // Alugados geralmente s√£o bons
            } else {
                pitch.innerText = "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ"; // Casa pr√≥pria
            }

            // Inputs
            document.getElementById('p-geral').value = dados.precos.geral;
            document.getElementById('p-cadeiras').value = dados.precos.cadeiras;
            document.getElementById('p-vip').value = dados.precos.vip;
            document.getElementById('p-park').value = dados.precos.estacionamento;

            renderizarAlugueis();
            calcRenda();
        };

        function switchTab(id, btn) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('visible'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-'+id).classList.add('visible');
            btn.classList.add('active');
        }

        function formatMoney(v) { return v.toLocaleString('pt-BR', {style:'currency', currency:'BRL'}); }

        // --- L√ìGICA ---
        function calcRenda() {
            const p = {
                geral: parseInt(document.getElementById('p-geral').value),
                cadeiras: parseInt(document.getElementById('p-cadeiras').value),
                vip: parseInt(document.getElementById('p-vip').value),
                estacionamento: parseInt(document.getElementById('p-park').value)
            };
            Engine.Estadios.salvarPrecos(p);
            const sim = Engine.Estadios.calcularBilheteria({forca:70});
            Engine.Estadios._tempPrecos = null;
            document.getElementById('proj-renda').innerText = formatMoney(sim.rendaTotal);
        }

        function salvarPrecos() {
            const p = {
                geral: parseInt(document.getElementById('p-geral').value),
                cadeiras: parseInt(document.getElementById('p-cadeiras').value),
                vip: parseInt(document.getElementById('p-vip').value),
                estacionamento: parseInt(document.getElementById('p-park').value)
            };
            Engine.Estadios.salvarConfig(p);
            alert("Pre√ßos atualizados!");
        }

        function calcObra() {
            const add = {
                geral: parseInt(document.getElementById('add-geral').value),
                cadeiras: parseInt(document.getElementById('add-cadeiras').value),
                vip: parseInt(document.getElementById('add-vip').value),
                estacionamento: parseInt(document.getElementById('add-park').value)
            };
            const orc = Engine.Estadios.calcularOrcamento(add);
            document.getElementById('obra-custo').innerText = formatMoney(orc.custo);
            document.getElementById('obra-tempo').innerText = orc.tempo + " Rodadas";
        }

        function iniciarObra() {
            if(!confirm("Iniciar reforma? O valor ser√° descontado.")) return;
            const add = {
                geral: parseInt(document.getElementById('add-geral').value),
                cadeiras: parseInt(document.getElementById('add-cadeiras').value),
                vip: parseInt(document.getElementById('add-vip').value),
                estacionamento: parseInt(document.getElementById('add-park').value)
            };
            const res = Engine.Estadios.iniciarReforma(add);
            alert(res.msg);
            if(res.sucesso) window.location.reload();
        }

        function renderizarAlugueis() {
            const lista = Engine.Estadios.listarEstadiosDisponiveis();
            const container = document.getElementById('lista-aluguel');
            container.innerHTML = "";

            lista.forEach(est => {
                const infraStars = est.infra === "Alta" ? "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ" : (est.infra === "M√©dia" ? "‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ" : "‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ");
                const div = document.createElement('div');
                div.className = 'rent-card';
                div.innerHTML = `
                    <div class="rent-details">
                        <div>${est.nome}</div>
                        <span class="rent-infra-tag">Gramado: ${infraStars}</span>
                        <small>Cap: ${est.cap.toLocaleString()}</small>
                    </div>
                    <div class="rent-price">
                        <div class="rent-val">${formatMoney(est.aluguel)}</div>
                        <button class="btn-rent" onclick="alugar('${est.id}')">ASSINAR</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function alugar(id) {
            const lista = Engine.Estadios.listarEstadiosDisponiveis();
            const alvo = lista.find(e => e.id == id);
            const duracao = document.getElementById('rent-duration').value;

            if(confirm(`Alugar ${alvo.nome} por ${duracao} jogos?`)) {
                const res = Engine.Estadios.assinarAluguel(alvo, duracao);
                alert(res.msg);
                if(res.sucesso) window.location.reload();
            }
        }
    </script>
</body>
</html>
