<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRFutebol - Infraestrutura</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <script src="database.js"></script>
    <script src="calendario.js"></script>
    <script src="engine-core.js"></script>
    <script src="engine-contratos.js"></script>
    <script src="engine-mercado.js"></script>
    <script src="engine-eventos.js"></script>
    <script src="engine-match.js"></script>
    <script src="engine-treino.js"></script>
    <script src="engine-estadio.js"></script>

    <style>
        :root { 
            --bg-dark: #121212; --panel-bg: #1e1e24; --panel-border: #2d2d35;
            --accent: #00ff88; --text-primary: #ffffff; --text-secondary: #a0a0b0;
            --danger: #ff4757; --warning: #ffa502;
        }
        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: var(--text-primary); margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        .header { height: 70px; background: #16161a; border-bottom: 1px solid var(--panel-border); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; }
        .app-brand { font-family: 'Rajdhani'; font-weight: 700; font-size: 1.5rem; } .app-brand span { color: var(--accent); }
        .btn-back { background: transparent; border: 1px solid var(--panel-border); color: var(--text-secondary); padding: 8px 16px; border-radius: 4px; text-decoration: none; font-size: 0.85rem; }
        
        .dashboard-grid { flex: 1; display: grid; grid-template-columns: 1fr 450px; gap: 20px; padding: 20px; overflow-y: auto; }

        /* EST√ÅDIO VISUAL */
        .visual-panel { display: flex; flex-direction: column; gap: 20px; }
        .hero-stadium { 
            flex: 1; background: linear-gradient(0deg, #121212 0%, rgba(18,18,18,0.4) 100%), url('https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/Pacaembu_%282972423853%29.jpg/1920px-Pacaembu_%282972423853%29.jpg');
            background-size: cover; background-position: center; border-radius: 12px; border: 1px solid var(--panel-border); 
            padding: 40px; display: flex; flex-direction: column; justify-content: flex-end; position: relative;
        }
        .obras-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(5px);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 12px; z-index: 10;
        }
        .obras-badge { background: var(--warning); color: #000; padding: 10px 20px; font-weight: 800; font-family: 'Rajdhani'; font-size: 2rem; transform: rotate(-5deg); border: 4px solid #fff; }

        .stadium-meta h1 { font-family: 'Rajdhani'; font-weight: 700; font-size: 3rem; margin: 0; line-height: 1; text-transform: uppercase; }
        .capacity-tag { margin-top: 20px; display: inline-flex; align-items: center; gap: 10px; background: rgba(0,0,0,0.6); padding: 8px 16px; border-radius: 6px; border: 1px solid var(--panel-border); }
        .capacity-number { font-family: 'Rajdhani'; font-weight: 700; font-size: 1.2rem; color: var(--accent); }

        /* ABAS E CONTROLES */
        .control-panel { background: var(--panel-bg); border: 1px solid var(--panel-border); border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; }
        .tabs { display: flex; border-bottom: 1px solid var(--panel-border); }
        .tab-btn { flex: 1; background: transparent; border: none; padding: 20px; color: var(--text-secondary); cursor: pointer; font-family: 'Rajdhani'; font-weight: 700; font-size: 1rem; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: #fff; border-bottom-color: var(--accent); background: rgba(255,255,255,0.02); }
        
        .tab-content { padding: 25px; display: none; flex-direction: column; gap: 20px; flex: 1; overflow-y: auto; }
        .tab-content.visible { display: flex; }

        /* INPUTS E SLIDERS */
        .input-group { display: flex; justify-content: space-between; align-items: center; background: #121212; padding: 15px; border-radius: 8px; border: 1px solid #333; }
        .input-label { font-size: 0.9rem; color: #ccc; }
        .input-control { width: 100px; background: #222; border: 1px solid #444; color: #fff; padding: 5px; border-radius: 4px; text-align: center; }
        
        .btn-action { background: var(--accent); color: #000; border: none; width: 100%; padding: 15px; font-family: 'Rajdhani'; font-weight: 700; font-size: 1.1rem; text-transform: uppercase; cursor: pointer; margin-top: auto; }
        .btn-action.disabled { background: #444; color: #888; cursor: not-allowed; }

        /* LISTA DE ALUGUEL */
        .rent-item { background: #121212; border: 1px solid #333; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .rent-info div { font-weight: bold; }
        .rent-info small { color: #888; }
        .btn-rent { background: transparent; border: 1px solid var(--accent); color: var(--accent); padding: 5px 15px; border-radius: 4px; cursor: pointer; font-weight: 700; }
        .btn-rent:hover { background: var(--accent); color: #000; }

        .current-rent { background: rgba(255, 165, 2, 0.1); border: 1px solid var(--warning); padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 20px; }
    </style>
</head>
<body>

    <header class="header">
        <div class="app-brand">BR<span>FUTEBOL</span></div>
        <a href="dashboard.html" class="btn-back">‚Üê Voltar</a>
    </header>

    <div class="dashboard-grid">
        
        <div class="visual-panel">
            <div class="hero-stadium">
                <div id="overlay-obras" class="obras-overlay" style="display: none;">
                    <div class="obras-badge">EM REFORMA</div>
                    <p style="margin-top:10px; color:#fff;">Previs√£o: <span id="rodadas-obras">0</span> rodadas</p>
                    <small>Mando de campo indispon√≠vel</small>
                </div>

                <div class="stadium-meta">
                    <h1 id="std-name">...</h1>
                    <p id="mando-atual">Mando: Seu Time</p>
                    <div class="capacity-tag">
                        <span class="capacity-label">Total</span>
                        <div style="width:1px; height:15px; background:#444; margin:0 10px;"></div>
                        <span class="capacity-number" id="std-cap">0</span>
                    </div>
                </div>
            </div>
            
            <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:10px;">
                <div class="input-group" style="flex-direction:column; align-items:flex-start;">
                    <span style="font-size:0.7rem; color:#888;">GERAL</span>
                    <span id="show-geral" style="font-weight:700;">0</span>
                </div>
                <div class="input-group" style="flex-direction:column; align-items:flex-start;">
                    <span style="font-size:0.7rem; color:#888;">CADEIRAS</span>
                    <span id="show-cadeiras" style="font-weight:700;">0</span>
                </div>
                <div class="input-group" style="flex-direction:column; align-items:flex-start;">
                    <span style="font-size:0.7rem; color:#888;">VIP</span>
                    <span id="show-vip" style="font-weight:700;">0</span>
                </div>
                <div class="input-group" style="flex-direction:column; align-items:flex-start;">
                    <span style="font-size:0.7rem; color:#888;">PARKING</span>
                    <span id="show-park" style="font-weight:700;">0</span>
                </div>
            </div>
        </div>

        <div class="control-panel">
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('ingressos')">Ingressos</button>
                <button class="tab-btn" onclick="switchTab('reforma')">Expans√£o & Aluguel</button>
            </div>

            <div id="tab-ingressos" class="tab-content visible">
                <p style="color:#888; font-size:0.9rem;">Defina os pre√ßos para jogos em casa.</p>
                
                <div class="input-group">
                    <span class="input-label">Geral (R$)</span>
                    <input type="number" id="price-geral" class="input-control" value="40">
                </div>
                <div class="input-group">
                    <span class="input-label">Cadeiras (R$)</span>
                    <input type="number" id="price-cadeiras" class="input-control" value="80">
                </div>
                <div class="input-group">
                    <span class="input-label">VIP (R$)</span>
                    <input type="number" id="price-vip" class="input-control" value="250">
                </div>
                <div class="input-group">
                    <span class="input-label">Estacionamento (R$)</span>
                    <input type="number" id="price-park" class="input-control" value="30">
                </div>

                <div style="margin-top:auto; padding:15px; background:#111; border:1px dashed #333; border-radius:8px;">
                    <span style="font-size:0.8rem; color:#888;">PROJE√á√ÉO DE RENDA</span>
                    <div style="font-size:1.5rem; color:var(--accent); font-weight:700;" id="proj-money">R$ 0,00</div>
                </div>
                
                <button class="btn-action" onclick="salvarPrecos()">Atualizar Pre√ßos</button>
            </div>

            <div id="tab-reforma" class="tab-content">
                
                <div id="rent-status" class="current-rent" style="display:none;">
                    <span style="color:var(--warning); font-weight:bold;">üèüÔ∏è JOGANDO EM CAMPO ALUGADO</span><br>
                    <span id="rent-name" style="color:#fff;">...</span><br>
                    <small>Custo por jogo: <span id="rent-cost">R$ 0</span></small>
                </div>

                <div id="form-reforma">
                    <h3 style="margin:0 0 10px 0;">Planejar Expans√£o</h3>
                    <p style="font-size:0.8rem; color:#aaa;">Custo aprox: R$ 1 Mi a cada 1.000 lugares.</p>

                    <div class="input-group">
                        <span class="input-label">+ Lugares Geral</span>
                        <select id="add-geral" class="input-control" onchange="calcOrcamento()">
                            <option value="0">0</option>
                            <option value="1000">+1.000</option>
                            <option value="5000">+5.000</option>
                            <option value="10000">+10.000</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <span class="input-label">+ Lugares Cadeiras</span>
                        <select id="add-cadeiras" class="input-control" onchange="calcOrcamento()">
                            <option value="0">0</option>
                            <option value="1000">+1.000</option>
                            <option value="5000">+5.000</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <span class="input-label">+ Lugares VIP</span>
                        <select id="add-vip" class="input-control" onchange="calcOrcamento()">
                            <option value="0">0</option>
                            <option value="100">+100</option>
                            <option value="500">+500</option>
                        </select>
                    </div>

                    <div style="margin-top:20px; padding:15px; background:#111; border-left:4px solid var(--warning);">
                        <div style="display:flex; justify-content:space-between;">
                            <span>Custo Estimado:</span>
                            <span id="orcamento-custo" style="color:#fff; font-weight:bold;">R$ 0</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-top:5px;">
                            <span>Tempo de Obra:</span>
                            <span id="orcamento-tempo" style="color:#fff; font-weight:bold;">0 Rodadas</span>
                        </div>
                        <small style="color:var(--danger); display:block; margin-top:10px;">* Est√°dio ficar√° indispon√≠vel durante a obra.</small>
                    </div>

                    <button class="btn-action" onclick="iniciarObras()" style="background:var(--warning); color:#000; margin-top:10px;">INICIAR REFORMA</button>
                </div>

                <div style="margin-top:30px;">
                    <h3 style="border-bottom:1px solid #333; padding-bottom:10px;">Negociar Aluguel</h3>
                    <div id="lista-aluguel">
                        </div>
                </div>

            </div>
        </div>

    </div>

    <script>
        let dados = null;

        window.onload = function() {
            if (typeof Engine === 'undefined') return;
            const game = Engine.carregarJogo();
            
            // Carrega e atualiza interface
            dados = Engine.Estadios.getEstadio();
            
            // Preenche Header e Infos
            document.getElementById('std-name').innerText = dados.nome;
            document.getElementById('std-cap').innerText = dados.capacidade.toLocaleString();
            
            // Setores
            document.getElementById('show-geral').innerText = dados.setores.geral.toLocaleString();
            document.getElementById('show-cadeiras').innerText = dados.setores.cadeiras.toLocaleString();
            document.getElementById('show-vip').innerText = dados.setores.vip.toLocaleString();
            document.getElementById('show-park').innerText = dados.setores.estacionamento.toLocaleString();

            // Pre√ßos
            document.getElementById('price-geral').value = dados.precos.geral;
            document.getElementById('price-cadeiras').value = dados.precos.cadeiras;
            document.getElementById('price-vip').value = dados.precos.vip;
            document.getElementById('price-park').value = dados.precos.estacionamento;

            // Verifica Status de Obra
            if(dados.emObras) {
                document.getElementById('overlay-obras').style.display = 'flex';
                document.getElementById('rodadas-obras').innerText = dados.rodadasObras;
                document.getElementById('form-reforma').style.display = 'none'; // Esconde form se ja ta em obra
            }

            // Verifica Aluguel
            if(dados.alugado) {
                document.getElementById('rent-status').style.display = 'block';
                document.getElementById('rent-name').innerText = dados.alugado.nome;
                document.getElementById('rent-cost').innerText = formatMoney(dados.alugado.custoPorJogo);
                document.getElementById('mando-atual').innerText = "Mandando em: " + dados.alugado.nome;
                document.getElementById('mando-atual').style.color = "var(--warning)";
            }

            // Gera Lista de Aluguel
            renderizarAlugueis();
            calcProjecaoSimples();
        };

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('visible'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById('tab-'+tabId).classList.add('visible');
            event.target.classList.add('active');
        }

        function calcOrcamento() {
            const adicoes = {
                geral: parseInt(document.getElementById('add-geral').value),
                cadeiras: parseInt(document.getElementById('add-cadeiras').value),
                vip: parseInt(document.getElementById('add-vip').value),
                estacionamento: 0
            };
            
            const orc = Engine.Estadios.calcularOrcamento(adicoes);
            document.getElementById('orcamento-custo').innerText = formatMoney(orc.custo);
            document.getElementById('orcamento-tempo').innerText = orc.tempo + " Rodadas";
        }

        function iniciarObras() {
            if(!confirm("Tem certeza? Isso vai gastar dinheiro e fechar o est√°dio.")) return;

            const adicoes = {
                geral: parseInt(document.getElementById('add-geral').value),
                cadeiras: parseInt(document.getElementById('add-cadeiras').value),
                vip: parseInt(document.getElementById('add-vip').value),
                estacionamento: 0
            };

            const res = Engine.Estadios.iniciarReforma(adicoes);
            alert(res.msg);
            if(res.sucesso) window.location.reload();
        }

        function renderizarAlugueis() {
            const lista = Engine.Estadios.listarEstadiosDisponiveis();
            const container = document.getElementById('lista-aluguel');
            container.innerHTML = "";

            lista.forEach(est => {
                const div = document.createElement('div');
                div.className = 'rent-item';
                div.innerHTML = `
                    <div class="rent-info">
                        <div>${est.nome}</div>
                        <small>Cap: ${est.cap.toLocaleString()} | ${est.infra}</small>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-weight:bold; color:var(--accent);">${formatMoney(est.aluguel)}/jogo</div>
                        <button class="btn-rent" onclick="alugar('${est.id}')">Negociar</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function alugar(id) {
            const lista = Engine.Estadios.listarEstadiosDisponiveis(); // Recarrega lista completa
            // Busca manual j√° que find pode falhar se ID for numero
            const alvo = lista.find(e => e.id == id); // == para garantir

            if(alvo) {
                const res = Engine.Estadios.assinarAluguel(alvo);
                alert(res.msg);
                if(res.sucesso) window.location.reload();
            }
        }

        function formatMoney(v) { return v.toLocaleString('pt-BR', {style:'currency', currency:'BRL'}); }

        function salvarPrecos() {
            const novos = {
                geral: parseInt(document.getElementById('price-geral').value),
                cadeiras: parseInt(document.getElementById('price-cadeiras').value),
                vip: parseInt(document.getElementById('price-vip').value),
                estacionamento: parseInt(document.getElementById('price-park').value)
            };
            Engine.Estadios.salvarConfig(novos);
            alert("Pre√ßos atualizados!");
            calcProjecaoSimples();
        }
        
        function calcProjecaoSimples() {
             const precosTela = {
                geral: parseInt(document.getElementById('price-geral').value),
                cadeiras: parseInt(document.getElementById('price-cadeiras').value),
                vip: parseInt(document.getElementById('price-vip').value),
                estacionamento: parseInt(document.getElementById('price-park').value)
            };
            Engine.Estadios.salvarPrecos(precosTela);
            const sim = Engine.Estadios.calcularBilheteria({forca:70});
            Engine.Estadios._tempPrecos = null;
            document.getElementById('proj-money').innerText = formatMoney(sim.rendaTotal);
        }
    </script>
</body>
</html>
