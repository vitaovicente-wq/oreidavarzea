<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendário da Temporada</title>
    
    <script src="engine.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700;800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #0f1216;
            --bg-panel: #1e2329;
            --accent: #00ff88;
            --text-main: #ffffff;
            --text-dim: #8b9bb4;
            --border: 1px solid rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 50%, #1a202c 0%, #0f1216 100%);
            color: var(--text-main);
            margin: 0;
            height: 100vh;
            display: flex; flex-direction: column;
        }

        /* HEADER */
        header {
            height: 60px; background: rgba(22, 27, 34, 0.95);
            border-bottom: var(--border);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; flex-shrink: 0; z-index: 10;
        }

        h1 { margin: 0; font-family: 'Rajdhani'; text-transform: uppercase; color: #fff; font-size: 1.5rem; letter-spacing: 1px; }
        .season-tag { background: #000; padding: 2px 10px; border-radius: 4px; border: 1px solid #333; font-size: 0.8rem; color: var(--accent); font-weight: bold; }

        .back-btn {
            background: rgba(255,255,255,0.05); border: var(--border); color: var(--text-dim);
            padding: 8px 20px; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 0.9rem;
            transition: 0.2s; text-decoration: none; display: flex; align-items: center; gap: 5px;
        }
        .back-btn:hover { background: rgba(255,255,255,0.1); color: #fff; border-color: #fff; }

        /* LISTA DE RODADAS */
        .calendar-container {
            flex: 1; overflow-y: auto; padding: 30px;
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); /* Responsivo */
            gap: 20px;
        }
        /* Scrollbar */
        .calendar-container::-webkit-scrollbar { width: 8px; }
        .calendar-container::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }

        /* CARD DA RODADA */
        .round-card {
            background: var(--bg-panel); border: var(--border); border-radius: 12px;
            padding: 15px; display: flex; flex-direction: column; gap: 10px;
            transition: transform 0.2s;
        }
        .round-card:hover { transform: translateY(-2px); border-color: #444; }
        
        /* Destaque para a rodada atual */
        .round-card.current {
            border: 2px solid var(--accent);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.1);
            background: linear-gradient(145deg, #1e2329 0%, #162b22 100%);
        }

        .round-header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; margin-bottom: 5px;
        }
        .round-title { font-family: 'Rajdhani'; font-weight: 800; font-size: 1.1rem; color: #fff; text-transform: uppercase; }
        .round-status { font-size: 0.7rem; font-weight: 700; color: #666; background: #0f1216; padding: 2px 8px; border-radius: 4px; }
        .current .round-status { color: #000; background: var(--accent); }

        /* LISTA DE JOGOS DENTRO DO CARD */
        .match-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 6px; border-radius: 4px; font-size: 0.9rem;
        }
        .match-row:nth-child(odd) { background: rgba(255,255,255,0.02); }
        
        /* Destaque para o jogo do meu time */
        .match-row.my-match {
            background: rgba(0, 255, 136, 0.15);
            border-left: 3px solid var(--accent);
            font-weight: 700;
        }

        .team-name { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .team-home { text-align: right; }
        .team-away { text-align: left; }
        
        .score-display {
            width: 60px; text-align: center; font-family: 'Rajdhani'; font-weight: 800;
            background: #000; border-radius: 4px; padding: 2px 0; margin: 0 10px;
            color: #fff; letter-spacing: 2px;
        }
        .pending-vs { color: #444; font-size: 0.8rem; }

    </style>
</head>
<body>

    <header>
        <button class="back-btn" onclick="window.location.href='dashboard.html'">❮ VOLTAR</button>
        <div style="display: flex; align-items: center; gap: 15px;">
            <h1>Calendário</h1>
            <span class="season-tag">Temporada 1</span>
        </div>
        <div style="width: 80px;"></div> </header>

    <div class="calendar-container" id="calendar-list">
        <div style="color: #666; text-align: center; padding: 50px;">Carregando jogos...</div>
    </div>

    <script>
        window.onload = function() {
            carregarCalendario();
        };

        function carregarCalendario() {
            // 1. Carregar Save
            const gameState = Engine.carregarJogo();
            
            if (!gameState || !gameState.calendario) {
                alert("Nenhum calendário encontrado. Inicie um novo jogo.");
                window.location.href = 'index.html';
                return;
            }

            const container = document.getElementById('calendar-list');
            container.innerHTML = ''; // Limpa msg de carregando
            
            const meuTime = gameState.meuTime;
            const rodadaAtual = gameState.rodada;

            // 2. Loop pelas Rodadas
            gameState.calendario.forEach((jogosDaRodada, index) => {
                const numRodada = index + 1;
                const isCurrent = (numRodada === rodadaAtual);
                const isPast = (numRodada < rodadaAtual);

                // Cria o Card
                const card = document.createElement('div');
                card.className = `round-card ${isCurrent ? 'current' : ''}`;
                if (isCurrent) card.id = 'current-round-card'; // Para scrollar

                // Status Texto
                let statusText = "EM BREVE";
                if (isCurrent) statusText = "RODADA ATUAL";
                if (isPast) statusText = "FINALIZADA";

                // Header do Card
                let html = `
                    <div class="round-header">
                        <span class="round-title">Rodada ${numRodada}</span>
                        <span class="round-status">${statusText}</span>
                    </div>
                `;

                // Jogos
                jogosDaRodada.forEach(jogo => {
                    // Verifica se é jogo do usuário para destacar
                    const ehMeuJogo = (jogo.casa === meuTime || jogo.fora === meuTime);
                    
                    // Placar ou "x"
                    let placarHtml = '';
                    if (jogo.placarCasa !== null && jogo.placarCasa !== undefined) {
                        // Jogo já aconteceu
                        // Pinta placar de verde/vermelho se for meu time
                        let corPlacar = "#fff";
                        if (ehMeuJogo) {
                            const golsMeus = (jogo.casa === meuTime) ? jogo.placarCasa : jogo.placarFora;
                            const golsAdv = (jogo.casa === meuTime) ? jogo.placarFora : jogo.placarCasa;
                            if (golsMeus > golsAdv) corPlacar = "#2ecc71"; // Vitória
                            else if (golsMeus < golsAdv) corPlacar = "#e74c3c"; // Derrota
                            else corPlacar = "#f1c40f"; // Empate
                        }
                        placarHtml = `<div class="score-display" style="color:${corPlacar}">${jogo.placarCasa} - ${jogo.placarFora}</div>`;
                    } else {
                        // Jogo futuro
                        placarHtml = `<div class="score-display"><span class="pending-vs">x</span></div>`;
                    }

                    // Linha do Jogo
                    html += `
                        <div class="match-row ${ehMeuJogo ? 'my-match' : ''}">
                            <div class="team-name team-home">${jogo.casa}</div>
                            ${placarHtml}
                            <div class="team-name team-away">${jogo.fora}</div>
                        </div>
                    `;
                });

                card.innerHTML = html;
                container.appendChild(card);
            });

            // 3. Auto-Scroll para a rodada atual
            setTimeout(() => {
                const el = document.getElementById('current-round-card');
                if (el) {
                    el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 500);
        }
    </script>
</body>
</html>
