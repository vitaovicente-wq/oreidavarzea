<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendário - BRFutebol</title>
    
    <style>
        :root {
            --bg: #0d1115;
            --card: #1e272e;
            --green: #2ecc71;
            --text: #ecf0f1;
            --border: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
        }

        /* CABEÇALHO */
        header {
            width: 100%; max-width: 600px;
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 20px; border-bottom: 1px solid var(--border);
            padding-bottom: 15px;
        }
        
        .btn-voltar {
            background: none; border: 1px solid var(--border);
            color: #888; padding: 8px 15px; border-radius: 6px;
            cursor: pointer; text-decoration: none; font-size: 0.9rem;
            transition: 0.2s;
        }
        .btn-voltar:hover { border-color: var(--text); color: var(--text); }

        h2 { margin: 0; font-size: 1.4rem; text-transform: uppercase; letter-spacing: 1px; }

        /* NAVEGAÇÃO DE RODADAS */
        .round-nav {
            display: flex; align-items: center; justify-content: center; gap: 20px;
            background: var(--card); padding: 10px 30px; border-radius: 30px;
            margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .nav-arrow {
            background: none; border: none; color: var(--green);
            font-size: 1.5rem; cursor: pointer; font-weight: bold;
            padding: 0 10px;
        }
        .nav-arrow:hover { transform: scale(1.2); }
        .round-title { font-weight: bold; font-size: 1.1rem; min-width: 120px; text-align: center; }

        /* LISTA DE JOGOS */
        .match-list {
            width: 100%; max-width: 600px;
            display: flex; flex-direction: column; gap: 10px;
        }

        .match-card {
            background: var(--card); padding: 15px; border-radius: 8px;
            display: flex; align-items: center; justify-content: space-between;
            border: 1px solid transparent; transition: 0.2s;
        }
        .match-card:hover { border-color: #444; background: #232d35; }
        
        /* Layout do Placar: Time Casa (40%) - Placar (20%) - Time Fora (40%) */
        .team { flex: 1; display: flex; align-items: center; gap: 10px; font-weight: 500; font-size: 0.95rem; }
        .team.home { justify-content: flex-end; text-align: right; }
        .team.away { justify-content: flex-start; text-align: left; }
        
        .team-logo { width: 30px; height: 30px; object-fit: contain; }
        
        .score-board {
            width: 80px; text-align: center;
            font-weight: 900; font-size: 1.2rem;
            background: #111; padding: 5px 0; border-radius: 4px;
            margin: 0 10px; border: 1px solid #333;
            color: var(--green);
        }
        .score-board.pending { color: #555; font-size: 0.9rem; font-weight: normal; }

        /* DESTAQUE PARA O SEU TIME */
        .match-card.my-match { border: 1px solid var(--green); background: rgba(46, 204, 113, 0.05); }

    </style>
</head>
<body>

    <header>
        <a href="dashboard.html" class="btn-voltar">← Voltar</a>
        <h2>Calendário</h2>
        <div style="width: 70px;"></div> </header>

    <div class="round-nav">
        <button class="nav-arrow" onclick="mudarRodada(-1)">‹</button>
        <div class="round-title" id="round-display">Rodada 1</div>
        <button class="nav-arrow" onclick="mudarRodada(1)">›</button>
    </div>

    <div id="matches-container" class="match-list">
        </div>

    <script>
        // --- LÓGICA DE EXIBIÇÃO ---

        let jogoSalvo = null;
        let rodadaVisualizada = 1;
        let meuTimeNome = "";

        // 1. Carrega os dados ao abrir a tela
        window.onload = function() {
            // Pega o save do LocalStorage
            const saveJson = localStorage.getItem('brfutebol_save');
            
            if (!saveJson) {
                alert("Nenhum jogo salvo encontrado! Volte para o início.");
                window.location.href = 'index.html';
                return;
            }

            jogoSalvo = JSON.parse(saveJson);
            meuTimeNome = jogoSalvo.meuTime; // Nome do time controlado pelo jogador
            
            // Define a rodada inicial como a rodada atual do jogo
            // (ou a última se o campeonato acabou)
            rodadaVisualizada = jogoSalvo.rodadaAtual || 1;
            
            // Garante que não passe do limite de rodadas
            const totalRodadas = jogoSalvo.calendario.length;
            if (rodadaVisualizada > totalRodadas) rodadaVisualizada = totalRodadas;

            renderizarRodada();
        };

        // 2. Função para desenhar os jogos na tela
        function renderizarRodada() {
            const container = document.getElementById('matches-container');
            const display = document.getElementById('round-display');
            
            // Limpa a lista
            container.innerHTML = '';
            
            // Atualiza o título da rodada
            display.innerText = `Rodada ${rodadaVisualizada}`;

            // Pega os dados da rodada específica (lembrando que array começa no 0)
            const dadosRodada = jogoSalvo.calendario[rodadaVisualizada - 1];

            if (!dadosRodada || !dadosRodada.jogos) {
                container.innerHTML = '<p style="text-align:center; color:#666">Nenhum jogo nesta rodada.</p>';
                return;
            }

            // Cria o card de cada jogo
            dadosRodada.jogos.forEach(jogo => {
                const card = document.createElement('div');
                card.className = 'match-card';

                // Verifica se é o jogo do usuário para destacar
                if (jogo.mandante === meuTimeNome || jogo.visitante === meuTimeNome) {
                    card.classList.add('my-match');
                }

                // Define o placar (ou "x" se ainda não jogou)
                let placarHTML = '';
                if (jogo.jogado) {
                    placarHTML = `<div class="score-board">${jogo.placarCasa} - ${jogo.placarFora}</div>`;
                } else {
                    placarHTML = `<div class="score-board pending">VS</div>`;
                }

                // Busca escudos (se você tiver salvo no objeto times, senão usa genérico)
                // Aqui assume um escudo padrão para evitar erro de imagem quebrada
                const escudoPadrao = "https://cdn-icons-png.flaticon.com/512/53/53283.png";

                card.innerHTML = `
                    <div class="team home">
                        <span>${jogo.mandante}</span>
                        <img src="${escudoPadrao}" class="team-logo">
                    </div>
                    ${placarHTML}
                    <div class="team away">
                        <img src="${escudoPadrao}" class="team-logo">
                        <span>${jogo.visitante}</span>
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // 3. Botões de Navegação
        function mudarRodada(direcao) {
            const novaRodada = rodadaVisualizada + direcao;
            const totalRodadas = jogoSalvo.calendario.length;

            if (novaRodada >= 1 && novaRodada <= totalRodadas) {
                rodadaVisualizada = novaRodada;
                renderizarRodada();
            }
        }
    </script>
</body>
</html>
