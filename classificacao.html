<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRFutebol - Estat√≠sticas Reais</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <script src="database.js"></script>
    <script src="engine-core.js"></script>

    <style>
        /* (MANTENHA O MESMO CSS DO ANTERIOR, EST√Å PERFEITO) */
        :root { 
            --bg: #0f1216; --panel: #1e2329; --border: #30363d; --text: #fff; --muted: #8b949e;
            --liberta: #2ecc71; --pre: #3498db; --sula: #f1c40f; --z4: #e74c3c; --acesso: #00ff88;
            --champions: #3498db; --europa: #e67e22;    
        }
        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 240px; background: #161b22; border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; gap: 8px; flex-shrink: 0; }
        .logo { font-family: 'Rajdhani'; font-size: 2rem; font-weight: 900; color: #fff; margin-bottom: 20px; }
        .logo span { color: var(--acesso); }
        .menu-btn { padding: 10px; color: var(--muted); text-decoration: none; font-weight: 600; border-radius: 6px; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
        .menu-btn:hover, .menu-btn.active { background: rgba(255,255,255,0.05); color: #fff; }
        .menu-btn.logout { margin-top: auto; color: var(--z4); }
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .header { padding: 15px 20px; border-bottom: 1px solid var(--border); background: #16161a; display: flex; justify-content: space-between; align-items: center; }
        .controls { display: flex; gap: 15px; align-items: center; }
        select { background: #111; color: #fff; border: 1px solid var(--border); padding: 8px; border-radius: 4px; font-family: 'Rajdhani'; font-weight: 700; cursor: pointer; outline: none; }
        .tabs { display: flex; gap: 5px; }
        .tab { background: transparent; border: 1px solid transparent; color: var(--muted); padding: 5px 12px; cursor: pointer; font-weight: 700; border-radius: 4px; font-size: 0.85rem; }
        .tab:hover { color: #fff; background: rgba(255,255,255,0.05); }
        .tab.active { background: var(--acesso); color: #000; }
        .grid { flex: 1; padding: 20px; overflow-y: auto; display: grid; grid-template-columns: 1fr 320px; gap: 20px; }
        .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; }
        .panel-head { padding: 10px 15px; background: #151518; border-bottom: 1px solid var(--border); font-family: 'Rajdhani'; font-weight: 700; font-size: 1.1rem; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { text-align: center; padding: 10px 5px; background: #111; color: var(--muted); font-size: 0.75rem; text-transform: uppercase; position: sticky; top: 0; z-index: 10; }
        th:nth-child(2) { text-align: left; }
        td { padding: 8px 5px; text-align: center; border-bottom: 1px solid var(--border); }
        td:nth-child(2) { text-align: left; }
        tr:hover { background: rgba(255,255,255,0.02); }
        .meu-time { background: rgba(0, 255, 136, 0.15) !important; font-weight: bold; border-left: 3px solid var(--acesso); }
        .club-flex { display: flex; align-items: center; gap: 8px; }
        .zone-cell { font-weight: 700; position:relative; }
        .legend-bar { padding: 10px; border-top: 1px solid var(--border); display: flex; gap: 15px; flex-wrap: wrap; font-size: 0.75rem; background: #121212; }
        .legend-item { display: flex; align-items: center; gap: 5px; color: var(--muted); }
        .dot { width: 8px; height: 8px; border-radius: 50%; }
        .scorer-item { display: flex; justify-content: space-between; padding: 10px 15px; border-bottom: 1px solid var(--border); align-items: center; }
        .scorer-info div:first-child { font-weight: 700; color: #fff; font-size: 0.9rem; }
        .scorer-info div:last-child { font-size: 0.75rem; color: var(--muted); }
        .goals { font-family: 'Rajdhani'; font-weight: 800; color: var(--acesso); font-size: 1.1rem; }
        @media(max-width: 900px) { .sidebar { display: none; } .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="logo">BR<span>FUTEBOL</span></div>
        <a href="dashboard.html" class="menu-btn">üìä Vis√£o Geral</a>
        <a href="escalacao.html" class="menu-btn">üëï Escala√ß√£o</a>
        <a href="mercado.html" class="menu-btn">üîÑ Mercado</a>
        <a href="calendario.html" class="menu-btn">üìÖ Calend√°rio</a>
        <a href="classificacao.html" class="menu-btn active">üèÜ Classifica√ß√£o</a>
        <a href="estadio.html" class="menu-btn">üèüÔ∏è Est√°dio</a>
        <a href="financeiro.html" class="menu-btn">üí∞ Finan√ßas</a>
        <a href="index.html" class="menu-btn logout" onclick="localStorage.clear()">‚úñ Sair</a>
    </nav>

    <main class="main-content">
        <div class="header">
            <div class="controls">
                <select id="sel-pais" onchange="mudarPais()">
                    <option value="brasil">üáßüá∑ Brasil</option>
                    <option value="inglaterra">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø Inglaterra</option>
                    <option value="espanha">üá™üá∏ Espanha</option>
                    <option value="italia">üáÆüáπ It√°lia</option>
                </select>
                <div class="tabs" id="tabs-div"></div>
            </div>
            <div style="font-size:0.8rem; font-weight:bold; color:var(--acesso);">DADOS REAIS (GLOBAL)</div>
        </div>

        <div class="grid">
            <div class="panel">
                <div class="panel-head">Classifica√ß√£o</div>
                <div style="flex:1; overflow-y: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th width="50">Pos</th>
                                <th>Clube</th>
                                <th width="35">P</th>
                                <th width="35">J</th>
                                <th width="35">V</th>
                                <th width="35">E</th>
                                <th width="35">D</th>
                                <th width="35">SG</th>
                            </tr>
                        </thead>
                        <tbody id="tb-body"></tbody>
                    </table>
                </div>
                <div class="legend-bar" id="legend-container"></div>
            </div>

            <div class="panel">
                <div class="panel-head">Artilharia</div>
                <div id="artilharia-list" style="overflow-y: auto; flex: 1;"></div>
            </div>
        </div>
    </main>

    <script>
        const config = {
            brasil: {
                ligas: [ {id:'serieA', n:'S√©rie A'}, {id:'serieB', n:'S√©rie B'}, {id:'serieC', n:'S√©rie C'}, {id:'serieD', n:'S√©rie D'} ],
                regras: {
                    serieA: [ { ate:4, cor:'var(--liberta)', txt:'Libertadores' }, { ate:6, cor:'var(--pre)', txt:'Pr√©-Liberta' }, { ate:12, cor:'var(--sula)', txt:'Sul-Americana' }, { ate:16, cor:'transparent', txt:'' }, { ate:20, cor:'var(--z4)', txt:'Rebaixamento' } ],
                    padrao: [ { ate:4, cor:'var(--acesso)', txt:'Acesso' }, { ate:16, cor:'transparent', txt:'' }, { ate:20, cor:'var(--z4)', txt:'Rebaixamento' } ]
                }
            },
            inglaterra: {
                ligas: [ {id:'Premier League', n:'Premier League'}, {id:'Championship', n:'Championship'} ],
                regras: {
                    'Premier League': [ { ate:4, cor:'var(--champions)', txt:'Champions' }, { ate:5, cor:'var(--europa)', txt:'Europa League' }, { ate:17, cor:'transparent', txt:'' }, { ate:20, cor:'var(--z4)', txt:'Rebaixamento' } ],
                    padrao: [ { ate:2, cor:'var(--acesso)', txt:'Acesso Direto' }, { ate:6, cor:'var(--pre)', txt:'Playoff' } ]
                }
            },
            espanha: { ligas: [{id:'La Liga', n:'La Liga'}], regras: { 'La Liga': [{ate:4, cor:'var(--champions)', txt:'Champions'}, {ate:17, cor:'transparent'}, {ate:20, cor:'var(--z4)', txt:'Rebaixamento'}] } },
            italia: { ligas: [{id:'Serie A', n:'Serie A'}], regras: { 'Serie A': [{ate:4, cor:'var(--champions)', txt:'Champions'}, {ate:17, cor:'transparent'}, {ate:20, cor:'var(--z4)', txt:'Rebaixamento'}] } }
        };

        let jogo = null;
        let pais = 'brasil';
        let div = 'serieA';

        window.onload = function() {
            if(typeof Engine !== 'undefined') jogo = Engine.carregarJogo();
            if(jogo) { pais = jogo.info.pais || 'brasil'; div = jogo.info.divisao || 'serieA'; }
            
            const sel = document.getElementById('sel-pais');
            if(sel.querySelector(`option[value="${pais}"]`)) sel.value = pais;

            renderTela();
        };

        function mudarPais() {
            pais = document.getElementById('sel-pais').value;
            div = config[pais].ligas[0].id;
            renderTela();
        }

        function renderTela() {
            renderAbas();
            // AGORA PEGA SEMPRE DADOS REAIS DO ENGINE
            const dadosTabela = Engine.getTabelaLiga(pais, div);
            const dadosArtilharia = Engine.getArtilhariaLiga(pais, div);
            
            montarTabela(dadosTabela);
            montarArtilharia(dadosArtilharia);
        }

        function renderAbas() {
            const c = document.getElementById('tabs-div');
            c.innerHTML = "";
            config[pais].ligas.forEach(l => {
                const b = document.createElement('button');
                b.className = `tab ${l.id === div ? 'active' : ''}`;
                b.innerText = l.n;
                b.onclick = () => { div = l.id; renderTela(); };
                c.appendChild(b);
            });
        }

        function montarTabela(dados) {
            const tb = document.getElementById('tb-body');
            tb.innerHTML = "";
            const legC = document.getElementById('legend-container');
            legC.innerHTML = "";

            if(!dados || dados.length === 0) {
                tb.innerHTML = "<tr><td colspan='8'>Liga n√£o iniciada. Avance a rodada.</td></tr>";
                return;
            }

            const regrasPais = config[pais].regras;
            const regras = regrasPais[div] || regrasPais.padrao || regrasPais['serieA'] || [];
            let legendasUsadas = new Set();
            
            dados.sort((a,b) => b.pts - a.pts || b.sg - a.sg);

            dados.forEach((t, i) => {
                const pos = i + 1;
                let cor = "transparent";
                let textoZona = "";

                for(let r of regras) {
                    if(pos <= r.ate) {
                        cor = r.cor;
                        textoZona = r.txt;
                        if(textoZona) legendasUsadas.add(JSON.stringify({c:cor, t:textoZona}));
                        break;
                    }
                }

                const tr = document.createElement('tr');
                if(t.nome === jogo.info.time) tr.className = "meu-time";

                tr.innerHTML = `
                    <td class="zone-cell" style="border-left: 4px solid ${cor};">${pos}¬∫</td>
                    <td><div class="club-flex"><span style="font-weight:600; color:#fff;">${t.nome}</span></div></td>
                    <td style="font-weight:bold; color:#fff;">${t.pts}</td>
                    <td>${t.j}</td>
                    <td>${t.v}</td>
                    <td>${t.e}</td>
                    <td>${t.d}</td>
                    <td>${t.sg}</td>
                `;
                tb.appendChild(tr);
            });

            legendasUsadas.forEach(json => {
                const item = JSON.parse(json);
                legC.innerHTML += `<div class="legend-item"><div class="dot" style="background:${item.c}"></div>${item.t}</div>`;
            });
        }

        function montarArtilharia(lista) {
            const div = document.getElementById('artilharia-list');
            div.innerHTML = "";
            lista.sort((a,b) => b.gols - a.gols);
            
            if(lista.length === 0) { div.innerHTML = "<div style='padding:15px; text-align:center; color:#666'>Sem gols.</div>"; return; }

            lista.slice(0, 15).forEach(j => {
                div.innerHTML += `
                    <div class="scorer-item">
                        <div class="scorer-info">
                            <div>${j.nome}</div>
                            <div>${j.time}</div>
                        </div>
                        <div class="goals">${j.gols}</div>
                    </div>
                `;
            });
        }
    </script>
</body>
</html>
