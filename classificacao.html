<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRFutebol - Estat√≠sticas</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <script src="database.js"></script>
    <script src="engine-core.js"></script>

    <style>
        :root { 
            --bg: #0f1216; --panel: #1e2329; --border: #30363d; --text: #fff; --muted: #8b949e;
            
            /* CORES DE ZONA */
            --liberta: #2ecc71;   /* Verde Escuro */
            --pre: #3498db;       /* Azul */
            --sula: #f1c40f;      /* Amarelo */
            --z4: #e74c3c;        /* Vermelho */
            --acesso: #00ff88;    /* Verde Neon (Sobe de divis√£o) */
            --champions: #3498db; 
            --europa: #e67e22;    
        }
        
        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR */
        .sidebar { width: 240px; background: #161b22; border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; gap: 8px; flex-shrink: 0; }
        .logo { font-family: 'Rajdhani'; font-size: 2rem; font-weight: 900; color: #fff; margin-bottom: 20px; }
        .logo span { color: var(--acesso); }
        .menu-btn { padding: 10px; color: var(--muted); text-decoration: none; font-weight: 600; border-radius: 6px; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
        .menu-btn:hover, .menu-btn.active { background: rgba(255,255,255,0.05); color: #fff; }
        .menu-btn.logout { margin-top: auto; color: var(--z4); }

        /* MAIN */
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        
        /* HEADER */
        .header { padding: 15px 20px; border-bottom: 1px solid var(--border); background: #16161a; display: flex; justify-content: space-between; align-items: center; }
        .controls { display: flex; gap: 15px; align-items: center; }
        
        select { background: #111; color: #fff; border: 1px solid var(--border); padding: 8px; border-radius: 4px; font-family: 'Rajdhani'; font-weight: 700; cursor: pointer; outline: none; }
        
        .tabs { display: flex; gap: 5px; }
        .tab { background: transparent; border: 1px solid transparent; color: var(--muted); padding: 5px 12px; cursor: pointer; font-weight: 700; border-radius: 4px; font-size: 0.85rem; }
        .tab:hover { color: #fff; background: rgba(255,255,255,0.05); }
        .tab.active { background: var(--acesso); color: #000; }

        /* GRID */
        .grid { flex: 1; padding: 20px; overflow-y: auto; display: grid; grid-template-columns: 1fr 320px; gap: 20px; }
        
        .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; }
        .panel-head { padding: 10px 15px; background: #151518; border-bottom: 1px solid var(--border); font-family: 'Rajdhani'; font-weight: 700; font-size: 1.1rem; }

        /* TABELA */
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { text-align: center; padding: 10px 5px; background: #111; color: var(--muted); font-size: 0.75rem; text-transform: uppercase; position: sticky; top: 0; z-index: 10; }
        th:nth-child(2) { text-align: left; }
        td { padding: 8px 5px; text-align: center; border-bottom: 1px solid var(--border); }
        td:nth-child(2) { text-align: left; }
        tr:hover { background: rgba(255,255,255,0.02); }

        .meu-time { background: rgba(0, 255, 136, 0.15) !important; font-weight: bold; border-left: 3px solid var(--acesso); }
        .club-flex { display: flex; align-items: center; gap: 8px; }
        
        /* INDICADORES DE ZONA */
        .zone-bar { width: 4px; height: 100%; position: absolute; left: 0; top: 0; }
        .zone-cell { position: relative; font-weight: 700; }
        
        /* LEGENDA */
        .legend-bar { padding: 10px; border-top: 1px solid var(--border); display: flex; gap: 15px; flex-wrap: wrap; font-size: 0.75rem; background: #121212; }
        .legend-item { display: flex; align-items: center; gap: 5px; color: var(--muted); }
        .dot { width: 8px; height: 8px; border-radius: 50%; }

        /* ARTILHARIA */
        .scorer-item { display: flex; justify-content: space-between; padding: 10px 15px; border-bottom: 1px solid var(--border); align-items: center; }
        .scorer-info div:first-child { font-weight: 700; color: #fff; font-size: 0.9rem; }
        .scorer-info div:last-child { font-size: 0.75rem; color: var(--muted); }
        .goals { font-family: 'Rajdhani'; font-weight: 800; color: var(--acesso); font-size: 1.1rem; }

        @media(max-width: 900px) { .sidebar { display: none; } .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="logo">BR<span>FUTEBOL</span></div>
        <a href="dashboard.html" class="menu-btn">üìä Vis√£o Geral</a>
        <a href="escalacao.html" class="menu-btn">üëï Escala√ß√£o</a>
        <a href="mercado.html" class="menu-btn">üîÑ Mercado</a>
        <a href="calendario.html" class="menu-btn">üìÖ Calend√°rio</a>
        <a href="classificacao.html" class="menu-btn active">üèÜ Classifica√ß√£o</a>
        <a href="estadio.html" class="menu-btn">üèüÔ∏è Est√°dio</a>
        <a href="financeiro.html" class="menu-btn">üí∞ Finan√ßas</a>
        <a href="index.html" class="menu-btn logout" onclick="localStorage.clear()">‚úñ Sair</a>
    </nav>

    <main class="main-content">
        <div class="header">
            <div class="controls">
                <select id="sel-pais" onchange="mudarPais()">
                    <option value="brasil">üáßüá∑ Brasil</option>
                    <option value="inglaterra">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø Inglaterra</option>
                    <option value="espanha">üá™üá∏ Espanha</option>
                    <option value="italia">üáÆüáπ It√°lia</option>
                </select>
                <div class="tabs" id="tabs-div"></div>
            </div>
            <div style="font-size:0.8rem; font-weight:bold; color:var(--muted);" id="status-txt">DADOS REAIS</div>
        </div>

        <div class="grid">
            <div class="panel">
                <div class="panel-head">Tabela de Classifica√ß√£o</div>
                <div style="flex:1; overflow-y: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th width="50">Pos</th>
                                <th>Clube</th>
                                <th width="35">P</th>
                                <th width="35">J</th>
                                <th width="35">V</th>
                                <th width="35">E</th>
                                <th width="35">D</th>
                                <th width="35">SG</th>
                            </tr>
                        </thead>
                        <tbody id="tb-body"></tbody>
                    </table>
                </div>
                <div class="legend-bar" id="legend-container"></div>
            </div>

            <div class="panel">
                <div class="panel-head">Artilharia</div>
                <div id="artilharia-list" style="overflow-y: auto; flex: 1;"></div>
            </div>
        </div>
    </main>

    <script>
        // CONFIGURA√á√ÉO COMPLETA DAS ZONAS (AQUI EST√Å O SEGREDO)
        const config = {
            brasil: {
                ligas: [ 
                    {id:'serieA', n:'S√©rie A'}, 
                    {id:'serieB', n:'S√©rie B'}, 
                    {id:'serieC', n:'S√©rie C'}, 
                    {id:'serieD', n:'S√©rie D'} 
                ],
                regras: {
                    // Regras da S√©rie A (Liberta/Sula)
                    serieA: [
                        { ate:4, cor:'var(--liberta)', txt:'Libertadores' },
                        { ate:6, cor:'var(--pre)', txt:'Pr√©-Liberta' },
                        { ate:12, cor:'var(--sula)', txt:'Sul-Americana' },
                        { ate:16, cor:'transparent', txt:'' },
                        { ate:20, cor:'var(--z4)', txt:'Rebaixamento' }
                    ],
                    // Regras gen√©ricas para B, C e D (Acesso/Rebaixamento)
                    padrao: [ 
                        { ate:4, cor:'var(--acesso)', txt:'Acesso √† Divis√£o Superior' },
                        { ate:16, cor:'transparent', txt:'' },
                        { ate:20, cor:'var(--z4)', txt:'Rebaixamento' }
                    ]
                }
            },
            inglaterra: {
                ligas: [ {id:'Premier League', n:'Premier League'}, {id:'Championship', n:'Championship'} ],
                regras: {
                    'Premier League': [
                        { ate:4, cor:'var(--champions)', txt:'Champions League' },
                        { ate:5, cor:'var(--europa)', txt:'Europa League' },
                        { ate:17, cor:'transparent', txt:'' },
                        { ate:20, cor:'var(--z4)', txt:'Rebaixamento' }
                    ],
                    padrao: [ { ate:2, cor:'var(--acesso)', txt:'Acesso Direto' }, { ate:6, cor:'var(--pre)', txt:'Playoff de Acesso' } ]
                }
            },
            espanha: { ligas: [{id:'La Liga', n:'La Liga'}], regras: { 'La Liga': [{ate:4, cor:'var(--champions)', txt:'Champions'}] } },
            italia: { ligas: [{id:'Serie A', n:'Serie A'}], regras: { 'Serie A': [{ate:4, cor:'var(--champions)', txt:'Champions'}] } }
        };

        let jogo = null;
        let pais = 'brasil';
        let div = 'serieA';

        window.onload = function() {
            if(typeof Engine !== 'undefined') jogo = Engine.carregarJogo();
            if(jogo) { 
                pais = jogo.info.pais || 'brasil'; 
                div = jogo.info.divisao || 'serieA'; 
            }
            
            const sel = document.getElementById('sel-pais');
            if(sel.querySelector(`option[value="${pais}"]`)) sel.value = pais;

            renderTela();
        };

        function mudarPais() {
            pais = document.getElementById('sel-pais').value;
            div = config[pais].ligas[0].id;
            renderTela();
        }

        function renderTela() {
            renderAbas();
            
            // Verifica se estou vendo a liga que estou jogando
            const isReal = (jogo && (jogo.info.pais||'brasil') === pais && jogo.info.divisao === div);
            
            const statusTxt = document.getElementById('status-txt');
            if(isReal) {
                statusTxt.innerText = "‚óè COMPETI√á√ÉO ATIVA";
                statusTxt.style.color = "var(--acesso)";
                montarTabela(jogo.classificacao, true);
                montarArtilhariaReal();
            } else {
                statusTxt.innerText = "‚óè SIMULA√á√ÉO (Database)";
                statusTxt.style.color = "#666";
                // Simula B, C e D se eu estiver na A
                const dadosSim = simularDados(pais, div);
                montarTabela(dadosSim.tabela, false);
                montarArtilhariaSim(dadosSim.artilharia);
            }
        }

        function renderAbas() {
            const c = document.getElementById('tabs-div');
            c.innerHTML = "";
            config[pais].ligas.forEach(l => {
                const b = document.createElement('button');
                b.className = `tab ${l.id === div ? 'active' : ''}`;
                b.innerText = l.n;
                b.onclick = () => { div = l.id; renderTela(); };
                c.appendChild(b);
            });
        }

        function montarTabela(dados, isReal) {
            const tb = document.getElementById('tb-body');
            tb.innerHTML = "";
            const legC = document.getElementById('legend-container');
            legC.innerHTML = "";

            // L√≥gica de Regras (A, B, C, D)
            const regrasPais = config[pais].regras;
            // Se tiver regra especifica (ex: serieA) usa, sen√£o usa padrao (acesso/rebaixamento)
            const regras = regrasPais[div] || regrasPais.padrao || regrasPais['serieA'] || [];
            
            let legendasUsadas = new Set();
            
            // Ordena√ß√£o
            dados.sort((a,b) => b.pts - a.pts || b.sg - a.sg);

            dados.forEach((t, i) => {
                const pos = i + 1;
                let cor = "transparent";
                let textoZona = "";

                for(let r of regras) {
                    if(pos <= r.ate) {
                        cor = r.cor;
                        textoZona = r.txt;
                        if(textoZona) legendasUsadas.add(JSON.stringify({c:cor, t:textoZona}));
                        break;
                    }
                }

                const tr = document.createElement('tr');
                if(isReal && t.nome === jogo.info.time) tr.className = "meu-time";

                // Borda lateral colorida na c√©lula da posi√ß√£o
                tr.innerHTML = `
                    <td class="zone-cell" style="border-left: 4px solid ${cor};">
                        ${pos}¬∫
                    </td>
                    <td><div class="club-flex"><span style="font-weight:600; color:#fff;">${t.nome}</span></div></td>
                    <td style="font-weight:bold; color:#fff;">${t.pts}</td>
                    <td>${t.j}</td>
                    <td>${t.v}</td>
                    <td>${t.e}</td>
                    <td>${t.d}</td>
                    <td>${t.sg}</td>
                `;
                tb.appendChild(tr);
            });

            // Legendas
            legendasUsadas.forEach(json => {
                const item = JSON.parse(json);
                legC.innerHTML += `<div class="legend-item"><div class="dot" style="background:${item.c}"></div>${item.t}</div>`;
            });
        }

        function montarArtilhariaReal() {
            const lista = [];
            jogo.times.forEach(t => {
                if(t.elenco) t.elenco.forEach(j => { if(j.gols > 0) lista.push({n:j.nome, t:t.nome, g:j.gols}); });
            });
            renderListaArt(lista);
        }

        function montarArtilhariaSim(lista) {
            renderListaArt(lista);
        }

        function renderListaArt(lista) {
            const div = document.getElementById('artilharia-list');
            div.innerHTML = "";
            lista.sort((a,b) => b.g - a.g);
            
            if(lista.length === 0) { div.innerHTML = "<div style='padding:15px; text-align:center; color:#666'>Sem gols.</div>"; return; }

            lista.slice(0, 15).forEach(j => {
                div.innerHTML += `
                    <div class="scorer-item">
                        <div class="scorer-info">
                            <div>${j.n}</div>
                            <div>${j.t}</div>
                        </div>
                        <div class="goals">${j.g}</div>
                    </div>
                `;
            });
        }

        function simularDados(p, d) {
            // Busca no DB
            const timesDB = (window.Database && window.Database[p]) ? window.Database[p][d] : [];
            if(!timesDB || timesDB.length === 0) return {tabela:[], artilharia:[]};

            const rodada = jogo ? jogo.rodadaAtual : 5;
            
            const tabela = timesDB.map(t => {
                const f = (t.forca||60)/100;
                // Simula√ß√£o matem√°tica para dar pontos realistas
                const pts = Math.floor(rodada * 2.6 * f) + Math.floor(Math.random()*4);
                const v = Math.floor(pts/3);
                const e = Math.max(0, Math.floor((rodada - v) * 0.3));
                const d = Math.max(0, rodada - v - e);
                return { nome: t.nome, pts: pts, j: rodada, v: v, e: e, d: d, sg: Math.floor(pts/3) };
            });

            const artilharia = timesDB.map(t => {
                // Tenta achar um craque no DB, sen√£o inventa
                const nomeCraque = t.destaque || (t.elenco && t.elenco[0] ? t.elenco[0].nome : "Atacante Principal");
                return { n: nomeCraque, t: t.nome, g: Math.floor(rodada * ((t.forca||60)/130)) };
            }).filter(x => x.g > 0);

            return { tabela, artilharia };
        }
    </script>
</body>
</html>
