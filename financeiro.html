<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRFutebol - Finan√ßas</title>
    
    <script src="database_jogadores.js"></script>
    <script src="engine.js"></script>

    <style>
        :root {
            --bg: #0d1115;
            --card-bg: #2d3436;
            --text: #ecf0f1;
            --gold: #f1c40f;
            --green: #2ecc71;
            --red: #ff4757;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 0;
            display: grid; grid-template-rows: 70px 1fr;
            height: 100vh; overflow: hidden;
        }

        header {
            background-color: rgba(30, 39, 46, 0.95);
            border-bottom: 2px solid var(--gold);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px;
        }

        .back-btn { background: #444; color: #fff; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .back-btn:hover { background: #555; }

        main {
            padding: 30px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%; box-sizing: border-box;
        }

        /* CARD PRINCIPAL (CAIXA) */
        .hero-card {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #2d3436 0%, #000 100%);
            border: 1px solid var(--gold);
            border-radius: 16px;
            padding: 30px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 10px 30px rgba(241, 196, 15, 0.1);
        }

        .hero-info h2 { margin: 0; color: #888; font-size: 1rem; text-transform: uppercase; letter-spacing: 1px; }
        .hero-info .value { font-size: 3rem; font-weight: 800; color: #fff; margin-top: 5px; }
        .hero-icon { font-size: 3rem; }

        /* SE√á√ïES */
        .section-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #444;
        }
        
        .section-header { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 15px; 
        }
        .section-title { font-size: 1.1rem; font-weight: bold; color: #fff; display: flex; align-items: center; gap: 10px; }

        /* LISTAS DE VALORES */
        .finance-row {
            display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 0.95rem;
        }
        .finance-row span:last-child { font-weight: bold; font-family: monospace; font-size: 1rem; }
        
        .val-green { color: var(--green); }
        .val-red { color: var(--red); }

        /* BARRA DE PROGRESSO */
        .progress-container { margin-top: 10px; }
        .progress-label { display: flex; justify-content: space-between; font-size: 0.8rem; color: #aaa; margin-bottom: 5px; }
        .progress-bg { background: #444; height: 8px; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 4px; }

        /* TABELA DE SAL√ÅRIOS */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; color: #888; font-size: 0.8rem; padding-bottom: 10px; border-bottom: 1px solid #444; }
        td { padding: 10px 0; border-bottom: 1px solid #333; font-size: 0.9rem; }
        .salary-val { text-align: right; color: #fff; font-family: monospace; }

    </style>
</head>
<body>

    <header>
        <button class="back-btn" onclick="voltar()">‚¨Ö Voltar ao Dashboard</button>
        <h1 style="color:white; font-size:1.2rem; text-transform:uppercase;">Departamento Financeiro</h1>
        <div style="width: 100px;"></div> </header>

    <main>
        <div class="hero-card">
            <div class="hero-info">
                <h2>Dinheiro em Caixa (Dispon√≠vel)</h2>
                <div class="value" id="val-caixa">R$ 0</div>
                <p style="color:#aaa; margin:5px 0 0 0; font-size:0.9rem;">Or√ßamento Anual: <span id="val-orcamento">R$ 0</span></p>
            </div>
            <div class="hero-icon">üè¶</div>
        </div>

        <div class="section-card">
            <div class="section-header">
                <div class="section-title"><span style="color:var(--green)">‚ñ≤</span> Receitas Previstas</div>
            </div>
            
            <div class="finance-row">
                <span>üì∫ Direitos de TV</span>
                <span class="val-green" id="rec-tv">R$ 0</span>
            </div>
            <div class="finance-row">
                <span>üëï Patroc√≠nio Master</span>
                <span class="val-green" id="rec-patrocinio">R$ 0</span>
            </div>
            <div class="finance-row">
                <span>üéüÔ∏è Bilheteria (Acumulada)</span>
                <span class="val-green" id="rec-bilheteria">R$ 0</span>
            </div>
            <div class="finance-row" style="border-top:1px solid #444; padding-top:10px; margin-top:20px;">
                <span>TOTAL RECEITAS</span>
                <span class="val-green" id="rec-total" style="font-size:1.2rem;">R$ 0</span>
            </div>
        </div>

        <div class="section-card">
            <div class="section-header">
                <div class="section-title"><span style="color:var(--red)">‚ñº</span> Despesas Anuais</div>
            </div>

            <div class="finance-row">
                <span>üë• Folha Salarial (Elenco)</span>
                <span class="val-red" id="desp-salarios">R$ 0</span>
            </div>
            
            <div class="progress-container">
                <div class="progress-label">
                    <span>Impacto no Or√ßamento</span>
                    <span id="impacto-pct">0%</span>
                </div>
                <div class="progress-bg">
                    <div class="progress-fill" id="bar-impacto" style="width: 0%; background: var(--red);"></div>
                </div>
            </div>

            <div class="finance-row" style="margin-top:20px;">
                <span>üèüÔ∏è Manuten√ß√£o / Est√°dio</span>
                <span class="val-red" id="desp-manutencao">R$ 0</span>
            </div>
            <div class="finance-row" style="border-top:1px solid #444; padding-top:10px; margin-top:20px;">
                <span>TOTAL DESPESAS</span>
                <span class="val-red" id="desp-total" style="font-size:1.2rem;">R$ 0</span>
            </div>
        </div>

        <div class="section-card" style="grid-column: 1 / -1;">
            <div class="section-header">
                <div class="section-title">‚≠ê Maiores Sal√°rios do Elenco</div>
            </div>
            <table id="table-salarios">
                <thead>
                    <tr>
                        <th>Jogador</th>
                        <th>Posi√ß√£o</th>
                        <th>Status</th>
                        <th style="text-align:right;">Sal√°rio Mensal (Estimado)</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>

    </main>

    <script>
        window.onload = function() {
            if (typeof Engine === 'undefined') { alert("Engine Off"); return; }
            
            const gameState = Engine.carregarJogo();
            if (!gameState) { window.location.href = 'index.html'; return; }

            const myTeamObj = gameState.times.find(t => t.nome === gameState.meuTime) || gameState.timesContinental.find(t => t.nome === gameState.meuTime);

            // Se n√£o tiver finan√ßas inicializadas (save antigo), inicializa agora
            if(!myTeamObj.financas) {
                Engine.inicializarFinancas(myTeamObj);
                Engine.salvarJogo(gameState);
            }

            renderizarTela(myTeamObj);
        };

        function renderizarTela(time) {
            const f = time.financas;
            const moeda = f.moeda;

            // Hero
            document.getElementById('val-caixa').innerText = Engine.formatarDinheiro(f.caixa, moeda);
            document.getElementById('val-orcamento').innerText = Engine.formatarDinheiro(f.orcamentoAnual, moeda);

            // Receitas
            document.getElementById('rec-tv').innerText = Engine.formatarDinheiro(f.receitas.tv, moeda);
            document.getElementById('rec-patrocinio').innerText = Engine.formatarDinheiro(f.receitas.patrocinioMaster, moeda);
            document.getElementById('rec-bilheteria').innerText = Engine.formatarDinheiro(f.receitas.bilheteria, moeda);
            
            const totalRec = f.receitas.tv + f.receitas.patrocinioMaster + f.receitas.bilheteria + f.receitas.premios;
            document.getElementById('rec-total').innerText = Engine.formatarDinheiro(totalRec, moeda);

            // Despesas
            document.getElementById('desp-salarios').innerText = Engine.formatarDinheiro(f.despesas.folhaSalarial, moeda);
            document.getElementById('desp-manutencao').innerText = Engine.formatarDinheiro(f.despesas.manutencao, moeda);
            
            const totalDesp = f.despesas.folhaSalarial + f.despesas.manutencao + f.despesas.transferencias;
            document.getElementById('desp-total').innerText = Engine.formatarDinheiro(totalDesp, moeda);

            // Barra de Impacto (Sal√°rios vs Receita Total Prevista)
            const impacto = (f.despesas.folhaSalarial / totalRec) * 100;
            document.getElementById('impacto-pct').innerText = impacto.toFixed(1) + "%";
            document.getElementById('bar-impacto').style.width = Math.min(impacto, 100) + "%";
            
            if(impacto > 80) document.getElementById('bar-impacto').style.backgroundColor = "#ff4757"; // Perigo
            else if(impacto > 60) document.getElementById('bar-impacto').style.backgroundColor = "#f1c40f"; // Aten√ß√£o
            else document.getElementById('bar-impacto').style.backgroundColor = "#2ecc71"; // Saud√°vel

            // Tabela de Sal√°rios (Top 10)
            const tbody = document.querySelector('#table-salarios tbody');
            const elencoOrdenado = [...time.elenco].sort((a,b) => b.salario - a.salario).slice(0, 10);

            elencoOrdenado.forEach(jog => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><b>${jog.nome}</b> <span style="font-size:0.8rem; color:#aaa;">(${jog.forca})</span></td>
                    <td>${jog.pos}</td>
                    <td>${jog.carac !== 'Normal' ? '‚≠ê Estrela' : 'Base'}</td>
                    <td class="salary-val">${Engine.formatarDinheiro(jog.salario, moeda)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function voltar() {
            window.location.href = 'dashboard.html';
        }
    </script>
</body>
</html>
