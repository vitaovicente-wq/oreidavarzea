<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRFutebol - Finan√ßas</title>
    
    <script src="database_jogadores.js"></script>
    <script src="engine.js"></script>

    <style>
        :root {
            --bg: #0d1115;
            --card: #1e272e;
            --text: #ecf0f1;
            --green: #2ecc71;
            --red: #ff4757;
            --gold: #f1c40f;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 0;
            display: grid; grid-template-rows: 70px 1fr;
            height: 100vh; overflow: hidden;
        }

        /* HEADER */
        header {
            background-color: rgba(30, 39, 46, 0.95);
            border-bottom: 2px solid var(--gold);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px;
        }
        .btn-back { background: #444; color: #fff; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-back:hover { background: #555; }

        /* LAYOUT */
        main {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            max-width: 1200px; margin: 0 auto; width: 100%; box-sizing: border-box;
            overflow-y: auto;
        }

        /* CARDS */
        .card {
            background: var(--card); border-radius: 12px; padding: 25px;
            border: 1px solid #333; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* CARD PRINCIPAL (FULL WIDTH) */
        .hero-card {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #2d3436 0%, #000 100%);
            border: 1px solid var(--gold);
            display: flex; justify-content: space-between; align-items: center;
        }
        .hero-val { font-size: 3rem; font-weight: 800; color: #fff; margin-top: 5px; }
        .hero-label { text-transform: uppercase; color: #888; font-size: 0.9rem; letter-spacing: 1px; }

        /* LISTAS DE VALORES */
        .finance-row { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 1rem; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .finance-row:last-child { border: none; }
        .val-plus { color: var(--green); font-weight: bold; font-family: monospace; }
        .val-minus { color: var(--red); font-weight: bold; font-family: monospace; }

        /* BARRA DE OR√áAMENTO */
        .budget-bar { height: 10px; background: #333; border-radius: 5px; overflow: hidden; margin-top: 20px; }
        .budget-fill { height: 100%; transition: width 1s; }

        /* TABELA SAL√ÅRIOS */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; color: #888; font-size: 0.8rem; padding-bottom: 10px; border-bottom: 2px solid #444; }
        td { padding: 12px 0; border-bottom: 1px solid #333; }
        .salary-val { text-align: right; font-family: monospace; color: #fff; }

    </style>
</head>
<body>

    <header>
        <button class="btn-back" onclick="window.location.href='dashboard.html'">‚¨Ö Dashboard</button>
        <h1 style="color:white; font-size:1.2rem; text-transform:uppercase;">Departamento Financeiro</h1>
        <div style="width:100px"></div>
    </header>

    <main>
        <div class="card hero-card">
            <div>
                <div class="hero-label">Dinheiro em Caixa</div>
                <div class="hero-val" id="val-caixa">R$ 0</div>
            </div>
            <div style="text-align:right;">
                <div class="hero-label">Balan√ßo da Temporada</div>
                <div id="val-projecao" style="font-size:1.5rem; font-weight:bold; margin-top:5px;">R$ 0</div>
            </div>
        </div>

        <div class="card">
            <h3 style="color:var(--green); margin-top:0;">‚ñ≤ Receitas</h3>
            
            <div class="finance-row">
                <span>üì∫ Cotas de TV</span>
                <span class="val-plus" id="rec-tv">0</span>
            </div>
            <div class="finance-row">
                <span>üëï Patroc√≠nio Master</span>
                <span class="val-plus" id="rec-patro">0</span>
            </div>
            <div class="finance-row">
                <span>üéüÔ∏è Bilheteria (Acumulado)</span>
                <span class="val-plus" id="rec-bilh">0</span>
            </div>
            <div class="finance-row">
                <span>üèÜ Premia√ß√µes</span>
                <span class="val-plus" id="rec-premios">0</span>
            </div>
        </div>

        <div class="card">
            <h3 style="color:var(--red); margin-top:0;">‚ñº Despesas (Anual)</h3>
            
            <div class="finance-row">
                <span>üë• Folha Salarial (Elenco)</span>
                <span class="val-minus" id="desp-folha">0</span>
            </div>
            <div class="finance-row">
                <span>üèüÔ∏è Manuten√ß√£o Est√°dio/CT</span>
                <span class="val-minus" id="desp-manu">0</span>
            </div>
            <div class="finance-row">
                <span>üîÑ Transfer√™ncias</span>
                <span class="val-minus" id="desp-transf">0</span>
            </div>

            <div style="margin-top:25px;">
                <div style="display:flex; justify-content:space-between; font-size:0.8rem; color:#aaa; margin-bottom:5px;">
                    <span>Comprometimento da Receita</span>
                    <span id="lbl-pct">0%</span>
                </div>
                <div class="budget-bar">
                    <div id="bar-pct" class="budget-fill" style="width:0%; background:var(--green);"></div>
                </div>
            </div>
        </div>

        <div class="card" style="grid-column: 1 / -1;">
            <h3 style="color:var(--gold); margin-top:0;">‚≠ê Folha de Pagamento</h3>
            <table id="salary-table">
                <thead>
                    <tr>
                        <th>Jogador</th>
                        <th>Posi√ß√£o</th>
                        <th>Status</th>
                        <th style="text-align:right;">Sal√°rio Mensal</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>

    </main>

    <script>
        window.onload = function() {
            if (typeof Engine === 'undefined') { alert("Engine Off"); return; }
            
            const gameState = Engine.carregarJogo();
            if (!gameState) { window.location.href = 'index.html'; return; }

            // Busca o time na estrutura global nova
            const time = Engine.encontrarTime(gameState, gameState.meuTime);
            
            // Inicializa se necess√°rio (compatibilidade)
            if(!time.financas) {
                Engine.inicializarFinancas(time);
                Engine.salvarJogo(gameState);
            }

            renderizarTela(time);
        };

        function renderizarTela(time) {
            const f = time.financas;
            const m = f.moeda || "R$";

            // 1. Valores Principais
            document.getElementById('val-caixa').innerText = Engine.formatarDinheiro(f.caixa, m);
            document.getElementById('rec-tv').innerText = Engine.formatarDinheiro(f.receitas.tv, m);
            document.getElementById('rec-patro').innerText = Engine.formatarDinheiro(f.receitas.patrocinioMaster, m);
            document.getElementById('rec-bilh').innerText = Engine.formatarDinheiro(f.receitas.bilheteria, m);
            document.getElementById('rec-premios').innerText = Engine.formatarDinheiro(f.receitas.premios || 0, m);

            document.getElementById('desp-folha').innerText = Engine.formatarDinheiro(f.despesas.folhaSalarial, m);
            document.getElementById('desp-manu').innerText = Engine.formatarDinheiro(f.despesas.manutencao, m);
            document.getElementById('desp-transf').innerText = Engine.formatarDinheiro(f.despesas.transferencias || 0, m);

            // 2. Proje√ß√£o (Receita Total - Despesa Total)
            const totalRec = f.receitas.tv + f.receitas.patrocinioMaster + f.receitas.bilheteria + (f.receitas.premios||0);
            const totalDesp = f.despesas.folhaSalarial + f.despesas.manutencao + (f.despesas.transferencias||0);
            const balanco = totalRec - totalDesp;

            const elProj = document.getElementById('val-projecao');
            elProj.innerText = (balanco > 0 ? "+" : "") + Engine.formatarDinheiro(balanco, m);
            elProj.style.color = balanco >= 0 ? "#2ecc71" : "#ff4757";

            // 3. Barra de Percentual
            const pct = Math.min(100, Math.floor((totalDesp / totalRec) * 100));
            document.getElementById('lbl-pct').innerText = pct + "%";
            document.getElementById('bar-pct').style.width = pct + "%";
            
            if(pct > 90) document.getElementById('bar-pct').style.backgroundColor = "#ff4757";
            else if(pct > 70) document.getElementById('bar-pct').style.backgroundColor = "#f1c40f";
            else document.getElementById('bar-pct').style.backgroundColor = "#2ecc71";

            // 4. Tabela de Sal√°rios
            const tbody = document.querySelector('#salary-table tbody');
            
            // Ordena por sal√°rio
            const elencoOrdenado = [...time.elenco].sort((a,b) => b.salario - a.salario);

            elencoOrdenado.forEach(jog => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><b>${jog.nome}</b> <small style="color:#777">(${jog.forca})</small></td>
                    <td>${jog.pos}</td>
                    <td>${jog.carac !== 'Normal' ? '‚≠ê Estrela' : 'Base'}</td>
                    <td class="salary-val">${Engine.formatarDinheiro(jog.salario, m)}</td>
                `;
                tbody.appendChild(tr);
            });
        }
    </script>
</body>
</html>
